# الفصل الثاني: التكوين الأساسي (Basic Configuration)

## نظرة عامة على الفصل

بعد ما أخدنا فكرة عامة عن FortiGate في الفصل اللي فات، دلوقتي جه وقت الجد! في الفصل ده، هنبدأ نخش في التكوين العملي لجهاز FortiGate. هنعرف إزاي نعمل الإعدادات الأولية للجهاز، وإزاي نكون الواجهات (Interfaces) بتاعته، اللي هي بوابات الدخول والخروج للشبكة. كمان، هنتعلم إزاي نعمل شبكات VLANs، اللي بتساعدنا نقسم الشبكة بتاعتنا لأجزاء أصغر وأكتر أماناً.

هنتكلم كمان عن الـ Virtual Domains (VDOMs)، ودي ميزة قوية في FortiGate بتخليك تقسم جهاز واحد لأكتر من جدار حماية افتراضي، كأنك عندك أكتر من جهاز فيزيائي. وهنشوف إزاي نتحكم في الوصول الإداري للجهاز، وإزاي نعمل تحديثات للـ Firmware عشان نضمن إن الجهاز بتاعنا شغال بأحدث إصدار وأكتر أماناً.

الفصل ده هو الأساس اللي هتبني عليه كل شغلك بعد كده على FortiGate، فركز كويس في كل خطوة!

## 2.1 الإعدادات الأولية (Initial Setup)

### 2.1.1 الوصول إلى FortiGate

أول ما بتشغل جهاز FortiGate لأول مرة، بيكون ليه إعدادات افتراضية عشان تقدر توصله وتعمله تكوين:

-   **عنوان IP الافتراضي:** `192.168.1.99/24` على منفذ `port1`.
-   **اسم المستخدم الافتراضي:** `admin`.
-   **كلمة المرور الافتراضية:** لا يوجد كلمة مرور (فارغة).

**خطوات الوصول الأولية:**
1.  وصل جهاز الكمبيوتر بتاعك بمنفذ `port1` على FortiGate.
2.  اعمل إعدادات الـ IP على كارت الشبكة بتاع الكمبيوتر بتاعك في نفس الشبكة (مثلاً: `192.168.1.100/24`).
3.  افتح المتصفح بتاعك واكتب `https://192.168.1.99`.
4.  هتظهرلك صفحة تسجيل الدخول، دخل `admin` وسيب كلمة المرور فاضية.
5.  أول ما تدخل، هيطلب منك تغير كلمة المرور، ودي خطوة مهمة جداً للأمان.

### 2.1.2 وضع التشغيل (Operation Mode)

FortiGate ممكن يشتغل في وضعين رئيسيين:

-   **وضع البوابة (NAT/Route Mode):**
    -   ده الوضع الأكثر شيوعاً. FortiGate بيشتغل كـ Router وجدار حماية بين الشبكات المختلفة (زي الشبكة الداخلية والإنترنت).
    -   بيعمل Network Address Translation (NAT) عشان يسمح للأجهزة الداخلية بالوصول للإنترنت باستخدام IP عام واحد.
    -   مناسب لمعظم سيناريوهات الشركات.

-   **وضع الشفافية (Transparent Mode):**
    -   FortiGate بيشتغل كـ Bridge أو Layer 2 Firewall. بيتم وضعه في مسار حركة المرور بدون ما يغير أي عناوين IP.
    -   بيكون شفاف للشبكة، يعني الأجهزة اللي وراه مش بتحس بوجوده.
    -   مناسب لو عايز تضيف FortiGate لشبكة موجودة من غير ما تغير في إعدادات الـ IP بتاعتها.

**تغيير وضع التشغيل (CLI):**
```
config system settings
    set opmode transparent # أو set opmode nat
end
```

**مقارنة بـ Cisco:**

Cisco ASA أيضاً بيدعم وضعين مشابهين: Routed Mode (مكافئ لـ NAT/Route Mode) و Transparent Mode. المفهوم واحد، لكن طريقة التكوين بتختلف.

## 2.2 تكوين الواجهات (Interface Configuration)

الواجهات هي نقاط الاتصال بين FortiGate والشبكات الأخرى. كل واجهة بيكون ليها IP Address، وبتكون مرتبطة بشبكة معينة (LAN, WAN, DMZ).

### 2.2.1 أنواع الواجهات

-   **واجهات فيزيائية (Physical Interfaces):** المنافذ المادية على الجهاز (مثلاً: port1, port2).
-   **واجهات VLAN (VLAN Interfaces):** واجهات منطقية بتتعمل فوق الواجهات الفيزيائية عشان نقسم الشبكة الواحدة لأكتر من شبكة افتراضية (VLAN).
-   **واجهات برمجية (Software Switch/Zone):** تجميع أكتر من واجهة فيزيائية أو منطقية في مجموعة واحدة عشان نطبق عليها سياسات أمنية موحدة.

### 2.2.2 تكوين واجهة فيزيائية (مثال: WAN Interface)

**عبر GUI:**
1.  انتقل إلى **(Network) -> (Interfaces)**.
2.  اختر الواجهة اللي عايز تعملها تكوين (مثلاً: `wan1`).
3.  **Role:** `WAN`.
4.  **Addressing Mode:** `Manual` (لو هتحط IP يدوي) أو `DHCP` (لو هياخد IP من مزود الخدمة).
5.  **IP/Netmask:** دخل عنوان الـ IP والـ Subnet Mask.
6.  **Administrative Access:** حدد الخدمات اللي هتسمح بالوصول ليها على الواجهة دي (مثلاً: `HTTPS`, `SSH`, `Ping`).

**عبر CLI:**
```
config system interface
    edit "wan1"
        set mode static
        set ip 203.0.113.2/24
        set allowaccess ping https ssh
        set role wan
    next
end
```

### 2.2.3 تكوين واجهة VLAN

**عبر GUI:**
1.  انتقل إلى **(Network) -> (Interfaces)**.
2.  انقر على **(Create New) -> (Interface)**.
3.  **Interface Type:** `VLAN`.
4.  **Physical Interface:** اختر الواجهة الفيزيائية اللي الـ VLAN هيتعمل عليها (مثلاً: `port2`).
5.  **VLAN ID:** دخل رقم الـ VLAN (مثلاً: `10`).
6.  **Role:** `LAN`.
7.  **Addressing Mode:** `Manual`.
8.  **IP/Netmask:** دخل عنوان الـ IP والـ Subnet Mask للـ VLAN (مثلاً: `192.168.10.1/24`).
9.  **Administrative Access:** حدد الخدمات المسموحة.

**عبر CLI:**
```
config system interface
    edit "vlan10"
        set vlanid 10
        set interface "port2"
        set ip 192.168.10.1/24
        set allowaccess ping https
        set role lan
    next
end
```

**مقارنة بـ Cisco:**

مفهوم الـ VLANs هو نفسه في Cisco. في Cisco، بتعمل Sub-interfaces على الـ Router أو الـ Layer 3 Switch، وبتعملها Encapsulation Dot1Q مع الـ VLAN ID. FortiGate بيعمل نفس الوظيفة ولكن بطريقة تكوين مختلفة.

## 2.3 النطاقات الافتراضية (Virtual Domains - VDOMs)

### 2.3.1 مفهوم VDOMs

VDOMs هي ميزة قوية في FortiGate بتسمحلك بتقسيم جهاز FortiGate واحد لأكتر من جدار حماية افتراضي مستقل. كل VDOM بيكون ليه سياساته الخاصة، واجهاته، وجداوله التوجيه، ومستخدميه، كأنه جهاز FortiGate منفصل تماماً.

**متى نستخدم VDOMs؟**
-   **مزودي الخدمة (Service Providers):** عشان يقدموا خدمات أمنية لعملاء مختلفين على نفس الجهاز.
-   **الشركات الكبيرة:** لتقسيم الشبكة لأقسام مستقلة (مثلاً: قسم المبيعات، قسم الموارد البشرية، شبكة الضيوف).
-   **البيئات متعددة المستأجرين (Multi-tenant Environments):** لتقديم خدمات أمنية لكيانات مختلفة داخل نفس المنظمة.

### 2.3.2 تكوين VDOMs

**الخطوة 1: تفعيل VDOMs (CLI):**

VDOMs بتكون غير مفعلة بشكل افتراضي. عشان تفعلها، لازم تدخل على الـ CLI.

```
config system global
    set vdom-mode multiple
end
```

**الخطوة 2: إنشاء VDOM جديد (GUI):**
1.  بعد تفعيل VDOMs، هتلاقي خيار جديد ظهر في الـ GUI تحت **(System) -> (VDOM)**.
2.  انقر على **(Create New)**.
3.  أدخل اسم الـ VDOM (مثلاً: `Sales_VDOM`).
4.  حدد الواجهات اللي هتكون جزء من الـ VDOM ده.

**عبر CLI:**
```
config vdom
    edit "Sales_VDOM"
    next
end
```

**الخطوة 3: تخصيص الموارد للـ VDOM:**

يمكنك تخصيص موارد الجهاز (CPU, Memory, Sessions) لكل VDOM لضمان الأداء.

**مقارنة بـ Cisco:**

Cisco ASA عندها مفهوم مشابه اسمه Contexts، بيسمح بتقسيم جهاز ASA واحد لأكتر من جدار حماية افتراضي. المفهوم واحد، لكن طريقة التكوين بتختلف.

## 2.4 الوصول الإداري (Administrative Access)

### 2.4.1 طرق الوصول الإداري

يمكنك الوصول إلى FortiGate لإدارته بعدة طرق:

-   **واجهة المستخدم الرسومية (GUI - HTTPS):** الطريقة الأكثر شيوعاً وسهولة.
-   **واجهة سطر الأوامر (CLI - SSH/Telnet):** للتحكم الدقيق والتكوينات المتقدمة.
-   **Console Port:** للوصول المباشر للجهاز في حالة عدم توفر الشبكة.

### 2.4.2 تأمين الوصول الإداري

تأمين الوصول الإداري لـ FortiGate أمر بالغ الأهمية:

-   **تغيير كلمة المرور الافتراضية:** أول خطوة بعد تسجيل الدخول لأول مرة.
-   **استخدام HTTPS و SSH فقط:** تجنب استخدام HTTP و Telnet لأنها غير مشفرة.
-   **تقييد الوصول على واجهات محددة:** اسمح بالوصول الإداري فقط على الواجهات الموثوقة (مثلاً: LAN أو Management Interface).
-   **تقييد الوصول لعناوين IP محددة:** اسمح فقط لعناوين IP معينة بالوصول الإداري.
-   **تفعيل المصادقة الثنائية (2FA):** إضافة طبقة أمان إضافية للمسؤولين.
-   **استخدام حسابات مستخدمين منفصلة:** لكل مسؤول حساب خاص به بدلاً من استخدام حساب `admin` الافتراضي.

**تكوين الوصول الإداري على واجهة (CLI):**
```
config system interface
    edit "lan"
        set allowaccess ping https ssh http # مثال: السماح بـ HTTPS و SSH
    next
end
```

**تكوين المستخدمين الإداريين (CLI):**
```
config system admin
    edit "new_admin"
        set password "SecurePassword!"
        set accprofile "super_admin" # تحديد صلاحيات المستخدم
        set vdom "root" # تحديد الـ VDOM الذي يمكن للمستخدم إدارته
        set trusthost 192.168.1.0 255.255.255.0 # السماح بالوصول من شبكة معينة
    next
end
```

## 2.5 إدارة التكوين (Configuration Management)

### 2.5.1 حفظ واستعادة التكوين

من المهم جداً حفظ نسخة احتياطية من تكوين FortiGate بانتظام، عشان لو حصل أي مشكلة تقدر ترجع للتكوين اللي كان شغال.

**حفظ التكوين (GUI):**
1.  انتقل إلى **(System) -> (Configuration) -> (Backup)**.
2.  اختر حفظ التكوين على جهاز الكمبيوتر بتاعك.

**حفظ التكوين (CLI):**
```
execute backup config ftp <filename> <ftp_server_ip> <username> <password>
execute backup config tftp <filename> <tftp_server_ip>
```

**استعادة التكوين (GUI):**
1.  انتقل إلى **(System) -> (Configuration) -> (Restore)**.
2.  اختر ملف التكوين اللي عايز تستعيده.

**استعادة التكوين (CLI):**
```
execute restore config ftp <filename> <ftp_server_ip> <username> <password>
execute restore config tftp <filename> <tftp_server_ip>
```

### 2.5.2 مراجعة التكوين (Configuration Audit)

FortiGate بيوفر أدوات لمراجعة التكوين وتحديد أي تغييرات حصلت.

-   **Configuration Revisions:** بيحتفظ بنسخ من التكوين كل ما يحصل تغيير، وتقدر ترجع لأي نسخة سابقة.
-   **Audit Logs:** بيسجل مين عمل إيه وإمتى على الجهاز.

## 2.6 إدارة البرامج الثابتة (Firmware Management)

### 2.6.1 أهمية تحديث الـ Firmware

تحديث الـ Firmware (نظام التشغيل) لـ FortiGate أمر حيوي لـ:
-   **الأمان:** سد الثغرات الأمنية المكتشفة.
-   **الميزات الجديدة:** الحصول على ميزات ووظائف جديدة.
-   **تحسين الأداء:** تحسين أداء الجهاز واستقراره.

### 2.6.2 خطوات تحديث الـ Firmware

**الخطوة 1: تحميل الـ Firmware:**

حمل أحدث إصدار من الـ Firmware من موقع Fortinet الرسمي (Support Portal).

**الخطوة 2: النسخ الاحتياطي للتكوين:**

**مهم جداً:** قبل أي تحديث للـ Firmware، لازم تاخد نسخة احتياطية من التكوين الحالي للجهاز.

**الخطوة 3: التحديث (GUI):**
1.  انتقل إلى **(System) -> (Firmware)**.
2.  انقر على **(Upload Firmware)**.
3.  اختر ملف الـ Firmware اللي حملته.
4.  الجهاز هيعمل إعادة تشغيل بعد التحديث.

**عبر CLI:**
```
execute restore image ftp <filename> <ftp_server_ip> <username> <password>
execute restore image tftp <filename> <tftp_server_ip>
```

**مقارنة بـ Cisco:**

عملية تحديث الـ IOS (نظام التشغيل) في أجهزة Cisco مشابهة: تحميل الـ IOS، أخذ نسخة احتياطية من التكوين، ثم تحديث الجهاز. المفهوم واحد، لكن الأوامر والملفات بتختلف.

## 2.7 خدمات FortiGuard (FortiGuard Services)

### 2.7.1 ما هي خدمات FortiGuard؟

خدمات FortiGuard هي مجموعة من خدمات الأمان القائمة على الاشتراك، بتقدمها Fortinet عشان تحمي أجهزة FortiGate من أحدث التهديدات. الخدمات دي بيتم تحديثها باستمرار من FortiGuard Labs، اللي بتراقب التهديدات العالمية 24/7.

**أمثلة على خدمات FortiGuard:**
-   **Antivirus Updates:** تحديثات لتوقيعات الفيروسات.
-   **IPS Updates:** تحديثات لتوقيعات أنظمة منع التسلل.
-   **Web Filtering:** قاعدة بيانات لتصنيف المواقع وحظر المواقع الضارة.
-   **Application Control:** قاعدة بيانات للتعرف على التطبيقات والتحكم فيها.
-   **Anti-Spam:** حماية ضد رسائل البريد المزعج.
-   **Security Rating:** تقييم أمني لتكوين FortiGate.

### 2.7.2 تفعيل خدمات FortiGuard

بعد شراء الاشتراك، بيتم تفعيل الخدمات تلقائياً على FortiGate. لازم تتأكد إن الجهاز متصل بالإنترنت عشان يقدر يستقبل التحديثات.

**التحقق من حالة FortiGuard (GUI):**
1.  انتقل إلى **(System) -> (FortiGuard)**.
2.  هتلاقي حالة كل خدمة (مفعلة، منتهية الصلاحية، إلخ).

**عبر CLI:**
```
get system fortiguard
```

## الخلاصة

في الفصل ده، أخدنا أولى خطواتنا العملية في تكوين FortiGate. عرفنا إزاي نعمل الإعدادات الأولية، ونكون الواجهات، ونقسم الشبكة باستخدام VLANs و VDOMs. كمان، اتعلمنا إزاي نأمن الوصول الإداري للجهاز، وإزاي نعمل نسخ احتياطية للتكوين، ونحدث الـ Firmware، ونستفيد من خدمات FortiGuard الأمنية.

الفصل ده هو حجر الأساس لأي تكوين على FortiGate. لو فهمت المفاهيم دي كويس وطبقتها عملي، هتكون جاهز إنك تدخل في الفصول الجاية اللي هنتكلم فيها عن سياسات جدار الحماية والميزات الأمنية المتقدمة. يلا بينا نكمل رحلتنا في عالم FortiGate!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

