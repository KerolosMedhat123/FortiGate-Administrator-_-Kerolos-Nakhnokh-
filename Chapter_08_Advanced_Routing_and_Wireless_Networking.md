# الفصل الثامن: التوجيه المتقدم والشبكات اللاسلكية (Advanced Routing and Wireless Networking)

## نظرة عامة على الفصل

يا جماعة، بعد ما خلصنا كلام عن إدارة FortiGate والتوافرية العالية، دلوقتي هنخش في مواضيع ممكن تكون متقدمة شوية بس مهمة جداً: التوجيه المتقدم (Advanced Routing) والشبكات اللاسلكية (Wireless Networking).

في الفصل ده، هنتعمق أكتر في بروتوكولات التوجيه الديناميكي زي OSPF و BGP، وهنشوف إزاي FortiGate بيتعامل معاها عشان يحدد أفضل مسار لحركة المرور في الشبكات الكبيرة والمعقدة. كمان، هنتكلم عن الـ Policy-Based Routing (PBR) اللي بتسمحلك تتحكم في مسار الترافيك بناءً على شروط معينة، مش بس بناءً على الـ Destination IP.

الجزء التاني من الفصل هيكون عن الشبكات اللاسلكية. FortiGate مش بس جدار حماية، ده كمان ممكن يشتغل كـ Wireless Controller عشان يدير نقاط الوصول اللاسلكية (Access Points) ويوفر شبكة Wi-Fi آمنة وموثوقة. هنشوف إزاي تكون شبكة Wi-Fi، وإزاي تأمنها، وإزاي تدير الـ Access Points.

الفصل ده هيفتحلك آفاق جديدة في تصميم وإدارة الشبكات باستخدام FortiGate. يلا بينا نخش في التفاصيل!

## 8.1 مفاهيم التوجيه المتقدم (Advanced Routing Concepts)

### 8.1.1 مراجعة سريعة للتوجيه (Routing Review)

فاكرين لما اتكلمنا عن الـ Static Routes في الفصول اللي فاتت؟ الـ Static Routes دي زي ما تكون بتدي FortiGate خريطة ثابتة وتقوله: 


لو عايز تروح للمكان الفلاني، امشي في الطريق ده. دي كويسة للشبكات الصغيرة أو لما تكون المسارات ثابتة ومبتتغيرش كتير.

لكن في الشبكات الكبيرة والمعقدة، اللي فيها فروع كتير، أو اللي متصلة بشبكات تانية (زي الإنترنت)، الـ Static Routes مش عملية. هنا بيجي دور بروتوكولات التوجيه الديناميكي (Dynamic Routing Protocols).

### 8.1.2 بروتوكولات التوجيه الديناميكي (Dynamic Routing Protocols)

بروتوكولات التوجيه الديناميكي بتخلي الـ Routers (أو FortiGate في حالتنا) يتبادلوا معلومات عن الشبكات اللي يعرفوها مع بعض. كده كل Router بيقدر يبني خريطة كاملة للشبكة، ولما يحصل أي تغيير (زي إن لينك يقع أو شبكة جديدة تتضاف)، كل الـ Routers بتعرف التغيير ده تلقائياً وبتعدل مساراتها.

**أمثلة على بروتوكولات التوجيه الديناميكي:**

-   **OSPF (Open Shortest Path First):**
    -   ده بروتوكول `Link-State`، يعني كل Router بيبعت معلومات عن اللينكات اللي متصل بيها وحالتها للـ Routers التانية في نفس الـ Area.
    -   بيستخدم خوارزمية Dijkstra عشان يحسب أقصر مسار لكل شبكة.
    -   مناسب للشبكات الكبيرة اللي ليها هيكل هرمي (Hierarchical) ومتقسمة لـ Areas.
    -   FortiGate بيدعم OSPF بشكل كامل، وممكن يشتغل كـ OSPF Router في الشبكة.

-   **BGP (Border Gateway Protocol):**
    -   ده بروتوكول `Path-Vector`، يعني كل Router بيبعت معلومات عن المسارات اللي يعرفها للـ Routers التانية، ومع كل مسار بيبعت معلومات عن الـ Autonomous Systems (AS) اللي الترافيك هيعدي عليها.
    -   ده البروتوكول اللي بيستخدم على الإنترنت عشان يربط بين الـ Autonomous Systems المختلفة (مزودي الخدمة الكبار، الشركات الكبيرة جداً).
    -   معقد أكتر من OSPF، ومناسب للشبكات اللي بتحتاج تتحكم في الترافيك اللي داخل وخارج من الـ AS بتاعها، أو اللي ليها اتصالات متعددة بالإنترنت.
    -   FortiGate بيدعم BGP، وممكن يشتغل كـ BGP Router.

**مقارنة بـ Cisco:**

Cisco هي الرائدة في بروتوكولات التوجيه، وبتدعم OSPF و BGP بشكل كامل على كل أجهزتها (Routers, Switches, Firewalls). المبادئ الأساسية لعمل البروتوكولات دي هي هي على FortiGate أو Cisco، لكن أوامر التكوين بتختلف.

### 8.1.3 التوجيه القائم على السياسات (Policy-Based Routing - PBR)

الـ PBR بتسمحلك تتحكم في مسار الترافيك بناءً على شروط معينة، مش بس بناءً على الـ Destination IP. يعني ممكن تقول للـ FortiGate: "لو الترافيك ده جاي من الـ IP الفلاني، أو رايح للـ IP الفلاني، أو بيستخدم البورت الفلاني، طلعه من الواجهة دي، حتى لو الـ Routing Table بيقول حاجة تانية".

**متى نستخدم PBR؟**
-   **توجيه ترافيك معين من واجهة محددة:** مثلاً، ترافيك الـ VoIP يطلع من لينك معين، وترافيك الإنترنت العادي يطلع من لينك تاني.
-   **Load Balancing:** توزيع الترافيك على أكتر من لينك.
-   **Failover:** لو لينك وقع، الترافيك يتحول تلقائياً للينك التاني.
-   **تجاوز الـ VPN:** لو عايز ترافيك معين ميمرش من الـ VPN Tunnel.

**تكوين PBR على FortiGate:**

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Policy Routes)**.
2.  انقر على **(Create New)**.
3.  حدد الـ **Incoming Interface**, **Source Address**, **Destination Address**, **Service** اللي عايز تطبق عليها الـ PBR.
4.  **Outgoing Interface:** اختار الواجهة اللي عايز الترافيك يطلع منها.
5.  **Gateway:** ممكن تحدد الـ Next-Hop IP.

**عبر CLI:**
```
config firewall policy-route
    edit 1
        set input-device "port1"
        set src "192.168.1.10"
        set dst "0.0.0.0"
        set protocol 6 # TCP
        set port 80 # HTTP
        set output-device "wan2"
        set gateway 10.0.0.1
    next
end
```

**مقارنة بـ Cisco PBR:**

Cisco بتدعم PBR بشكل كامل باستخدام الـ Route-Maps. المفهوم هو نفسه: بتحدد الـ Match Criteria (زي Source IP, Destination IP, Protocol) والـ Set Actions (زي Next-Hop IP, Output Interface). FortiGate بيقدم واجهة أبسط شوية، لكن الوظيفة هي هي.

## 8.2 الشبكات اللاسلكية (Wireless Networking)

### 8.2.1 FortiGate كـ Wireless Controller

FortiGate مش بس جدار حماية، ده كمان ممكن يشتغل كـ Wireless Controller عشان يدير نقاط الوصول اللاسلكية (FortiAPs). ده بيخليك تدير الشبكة السلكية واللاسلكية من مكان واحد، وبتطبق نفس السياسات الأمنية على الاتنين.

**ميزات FortiGate كـ Wireless Controller:**
-   **إدارة مركزية:** إدارة كل الـ FortiAPs من واجهة FortiGate واحدة.
-   **تكوين موحد:** تطبيق نفس إعدادات الـ Wi-Fi والـ Security Profiles على كل الـ FortiAPs.
-   **أمان متكامل:** تطبيق Firewall Policies و Security Profiles على الترافيك اللاسلكي.
-   **رؤية شاملة:** مراقبة أداء الشبكة اللاسلكية والمستخدمين المتصلين.

### 8.2.2 تكوين شبكة Wi-Fi (SSID)

**الخطوة 1: توصيل FortiAP بـ FortiGate:**
-   وصل الـ FortiAP بأي بورت على FortiGate (يفضل بورت مخصص للـ APs).
-   الـ FortiAP هيعمل Discover للـ FortiGate تلقائياً وهيسجل نفسه.

**الخطوة 2: تكوين SSID (Service Set Identifier) (GUI):**
1.  انتقل إلى **(WiFi & Switch Controller) -> (SSID)**.
2.  انقر على **(Create New)**.
3.  **Name:** اسم الشبكة اللاسلكية (مثلاً: `My_Secure_WiFi`).
4.  **Traffic Mode:**
    -   **Tunnel:** كل الترافيك من الـ AP بيروح للـ FortiGate عشان يتم فحصه وتطبيق السياسات عليه (الأكثر أماناً).
    -   **Bridge:** الـ AP بيعمل Bridge للترافيك مباشرة على الشبكة المحلية (أقل أماناً، لكن ممكن يكون أسرع).
5.  **Security Mode:**
    -   **Open:** بدون كلمة سر (غير آمن).
    -   **WPA2-Personal:** كلمة سر مشتركة (مناسب للشبكات الصغيرة).
    -   **WPA2-Enterprise:** بيستخدم خادم RADIUS للمصادقة (الأكثر أماناً للشركات).
6.  **VLAN ID:** ممكن تحدد VLAN للشبكة اللاسلكية دي عشان تعزلها عن الشبكات التانية.

**عبر CLI:**
```
config wireless-controller vap
    edit "My_Secure_WiFi"
        set ssid "My_Secure_WiFi"
        set security wpa2-personal
        set wpa-key "WiFiPassword123!"
        set vlanid 10
        set traffic-mode tunnel
    next
end
```

**الخطوة 3: ربط SSID بواجهة (GUI):**
1.  انتقل إلى **(WiFi & Switch Controller) -> (Managed FortiAPs)**.
2.  اختار الـ FortiAP اللي عايز تطبق عليه الـ SSID ده.
3.  في قسم **(Radio)**، اختار الـ SSID اللي عملته.

**الخطوة 4: إنشاء Firewall Policy للشبكة اللاسلكية:**

هتعمل سياسة تسمح للمستخدمين اللاسلكيين بالوصول للإنترنت، وتطبق عليها الـ Security Profiles المناسبة.

**مقارنة بـ Cisco Wireless LAN Controllers (WLC):**

Cisco WLCs بتوفر نفس الوظائف لإدارة نقاط الوصول اللاسلكية (Cisco Aps). بتسمح بتكوين SSIDs، وتطبيق سياسات أمنية، وإدارة المستخدمين. المفهوم هو نفسه: إدارة مركزية للشبكة اللاسلكية وتطبيق سياسات أمنية عليها.

## الخلاصة

في الفصل ده، اتعمقنا في مواضيع متقدمة زي التوجيه الديناميكي (OSPF, BGP) والـ Policy-Based Routing، اللي بتخليك تتحكم في حركة المرور بشكل دقيق جداً في الشبكات المعقدة. كمان، عرفنا إزاي FortiGate بيشتغل كـ Wireless Controller عشان يدير الشبكات اللاسلكية ويوفر حماية متكاملة.

دلوقتي أنت بقيت قادر على تصميم وإدارة شبكات أكبر وأكثر تعقيداً باستخدام FortiGate، وتوفر حلول توجيه متقدمة وشبكات لاسلكية آمنة. الفصل ده بيفتحلك أبواب كتير في عالم الشبكات.

يلا بينا على الفصل اللي جاي عشان نتكلم عن ميزات أمنية متقدمة أكتر، زي الـ SSL Inspection والـ Advanced Threat Protection، اللي بتخلي FortiGate خط الدفاع الأول ضد أحدث التهديدات.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

