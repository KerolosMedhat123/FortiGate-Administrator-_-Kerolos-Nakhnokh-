# الفصل الأول: مقدمة إلى FortiGate (Introduction to FortiGate)

## نظرة عامة على الفصل

أهلاً بكم يا شباب في أول فصل من شرحنا الشامل لمنهج FortiGate! لو أنت مهندس شبكات، أو أمن معلومات، أو حتى لسه بتبدأ في المجال ده، فـ FortiGate ده جهاز لازم تكون فاهمه كويس جداً. ليه؟ لأنه واحد من أقوى وأشهر جدران الحماية (Firewalls) في السوق، وبيستخدم في شركات كتير جداً، من الصغيرة لحد الشركات العملاقة.

في الفصل ده، هندخل عالم FortiGate خطوة بخطوة. هنفهم إيه هو FortiGate، وإيه اللي بيميزه عن أي جدار حماية تاني، وإيه هي عائلة منتجات Fortinet اللي FortiGate جزء منها. كمان، هنبص على تاريخ Fortinet وإزاي وصلت للمكانة اللي هي فيها دلوقتي. كل ده عشان نبني أساس قوي قبل ما ندخل في التفاصيل التقنية المعقدة.

اعتبر الفصل ده هو البوابة اللي هتفتحلك الطريق لعالم FortiGate، وهتفهم منه ليه الجهاز ده مهم جداً في أي بنية تحتية للشبكات.

## 1.1 ما هو FortiGate؟

### 1.1.1 تعريف FortiGate

FortiGate هو جدار حماية من الجيل التالي (Next-Generation Firewall - NGFW) من شركة Fortinet. ببساطة، هو جهاز بيتحط على حدود الشبكة بتاعتك عشان يحميها من أي هجمات أو تهديدات جاية من بره، وفي نفس الوقت بيتحكم في اللي بيخرج من الشبكة بتاعتك للإنترنت.

بس FortiGate مش مجرد جدار حماية عادي، ده NGFW، يعني بيعمل حاجات أكتر بكتير من مجرد السماح أو الرفض بناءً على الـ IP والـ Port. بيقدر يفهم التطبيقات اللي بتستخدمها (زي الفيسبوك أو الواتساب)، ويكتشف الفيروسات، ويمنع الاختراقات، ويتحكم في تصفح الويب، وحاجات تانية كتير. عشان كده بنسميه Unified Threat Management (UTM) أو إدارة التهديدات الموحدة، لأنه بيجمع أكتر من وظيفة أمنية في جهاز واحد.

### 1.1.2 FortiGate كجزء من حلول الأمن الشاملة

FortiGate هو حجر الزاوية في Fortinet Security Fabric. تخيل إن Fortinet عاملة شبكة أمان متكاملة، كل أجهزتها ومنتجاتها بتكلم بعض وبتتبادل المعلومات عشان توفر حماية قوية جداً. FortiGate هو القلب بتاع الشبكة دي، بيتصل بمنتجات تانية زي:

-   **FortiAnalyzer:** عشان يجمع السجلات والتقارير من كل أجهزة FortiGate ويحللها.
-   **FortiManager:** عشان تدير كل أجهزة FortiGate بتاعتك من مكان واحد، وده بيسهل الشغل لو عندك أجهزة كتير.
-   **FortiClient:** برنامج بينزل على أجهزة المستخدمين عشان يحميهم ويوفر اتصال VPN آمن.
-   **FortiWeb:** جدار حماية لتطبيقات الويب (Web Application Firewall - WAF) بيحمي المواقع بتاعتك من الهجمات.
-   **FortiMail:** لحماية البريد الإلكتروني.
-   **FortiSandbox:** لتحليل الملفات المشبوهة في بيئة معزولة عشان يكتشف الفيروسات الجديدة.

كل المنتجات دي بتشتغل مع بعض عشان توفر حماية متكاملة للشبكة بتاعتك، وده اللي بيميز Fortinet عن غيرها.

### 1.1.3 مقارنة سريعة: FortiGate vs. Cisco ASA

كتير منكم ممكن يكونوا عارفين Cisco ASA، وهو جدار حماية قوي ومشهور. إيه الفرق بينه وبين FortiGate؟

| الميزة | FortiGate (NGFW/UTM) | Cisco ASA (Traditional Firewall) |
|---|---|---|
| **الوظائف الأساسية** | جدار حماية، IPS، Antivirus، Web Filter، Application Control، VPN، إلخ. (كل ده في جهاز واحد) | جدار حماية، VPN (وظائف أمنية أساسية) |
| **التحكم في التطبيقات** | بيقدر يتعرف على التطبيقات (زي الفيسبوك، يوتيوب) ويتحكم فيها بغض النظر عن المنفذ | بيعتمد بشكل أساسي على المنافذ (Port-based) |
| **التهديدات المتقدمة** | حماية متقدمة ضد الفيروسات الجديدة والتهديدات المعقدة | بيحتاج تكامل مع أجهزة تانية (زي Firepower) عشان يوفر حماية متقدمة |
| **سهولة الإدارة** | واجهة رسومية (GUI) سهلة الاستخدام، و CLI قوي | CLI قوي، و GUI (ASDM) أقل مرونة |
| **التكلفة** | حل متكامل ممكن يكون أوفر على المدى الطويل | ممكن يحتاج أجهزة إضافية عشان يوفر نفس مستوى الحماية، وده بيزود التكلفة |

الخلاصة: FortiGate بيوفر حماية أوسع وأعمق في جهاز واحد، وده بيخليه مناسب جداً للشركات اللي عايزة حل أمني متكامل وسهل الإدارة.

## 1.2 تاريخ Fortinet و FortiGate

### 1.2.1 نشأة Fortinet

شركة Fortinet اتأسست سنة 2000 على إيد الأخوين كينج فاه (Ken Xie) ومايكل فاه (Michael Xie). كينج فاه ده كان ليه تاريخ طويل في مجال الأمن، وهو اللي أسس شركة NetScreen Technologies قبل كده (اللي سيسكو اشترتها بعدين). فكان عنده رؤية واضحة لمستقبل أمن الشبكات.

في بداية الألفينات، كانت جدران الحماية التقليدية هي السائدة، وكانت الشركات بتشتري أجهزة منفصلة لكل وظيفة أمنية (جدار حماية، مكافحة فيروسات، IPS). كينج فاه شاف إن ده مش عملي ومكلف، وقرر يعمل جهاز واحد يجمع كل الوظائف دي، وده كان بداية فكرة الـ UTM.

### 1.2.2 تطور FortiGate

أول جهاز FortiGate نزل السوق سنة 2002، وكان ثورة في مجال أمن الشبكات. الجهاز ده كان بيقدم كل ميزات الـ UTM في صندوق واحد، وده وفر على الشركات فلوس كتير وبسط الإدارة. من ساعتها، Fortinet فضلت تطور في FortiGate وتضيفله ميزات جديدة باستمرار، زي:

-   **NGFW Capabilities:** القدرة على التعرف على التطبيقات والمستخدمين.
-   **Threat Intelligence:** الاستفادة من معلومات التهديدات العالمية من FortiGuard Labs.
-   **SD-WAN:** دمج تقنيات الشبكات المعرفة برمجياً لتحسين أداء الشبكة.
-   **Cloud Integration:** التكامل مع البيئات السحابية.

النهاردة، FortiGate مش مجرد جهاز، ده نظام بيئي كامل من الأجهزة والخدمات اللي بتوفر حماية شاملة للشبكات، وده اللي خلاه واحد من رواد السوق في مجال أمن الشبكات.

## 1.3 عائلة منتجات Fortinet

Fortinet مش بس FortiGate، دي شركة عندها مجموعة كبيرة جداً من المنتجات والحلول الأمنية اللي بتغطي كل جوانب أمن الشبكات. المنتجات دي بتشتغل مع بعضها عشان توفر ما يسمى بـ Fortinet Security Fabric.

### 1.3.1 FortiGate (NGFW)

زي ما قلنا، ده المنتج الأساسي، وهو جدار الحماية من الجيل التالي اللي بيوفر حماية شاملة للشبكة.

### 1.3.2 FortiAnalyzer (Log Management & Reporting)

ده الجهاز اللي بيجمع كل السجلات (Logs) من أجهزة FortiGate التانية، وبيحللها، وبيطلع منها تقارير مفصلة عن حالة الشبكة والتهديدات الأمنية. مهم جداً عشان تعرف إيه اللي بيحصل في شبكتك.

### 1.3.3 FortiManager (Centralized Management)

لو عندك أكتر من جهاز FortiGate، أو أجهزة Fortinet تانية، FortiManager بيخليك تديرهم كلهم من مكان واحد. ده بيوفر وقت ومجهود كبير، وبيضمن إن كل الأجهزة عندها نفس السياسات الأمنية.

### 1.3.4 FortiClient (Endpoint Security)

ده برنامج بينزل على أجهزة الكمبيوتر والموبايلات بتاعة المستخدمين. بيوفر حماية ضد الفيروسات، وبيسمح بالاتصال الآمن بالشبكة عن طريق VPN، وبيضمن إن الأجهزة دي متوافقة مع سياسات الأمان بتاعة الشركة.

### 1.3.5 FortiWeb (Web Application Firewall - WAF)

ده جدار حماية متخصص في حماية تطبيقات الويب (المواقع الإلكترونية) من الهجمات اللي بتستهدف الثغرات في الأكواد بتاعتها، زي SQL Injection و XSS. مهم جداً لو عندك موقع ويب مهم.

### 1.3.6 FortiMail (Email Security)

لحماية البريد الإلكتروني من الرسائل الضارة، والتصيد الاحتيالي (Phishing)، والبريد المزعج (Spam).

### 1.3.7 FortiSandbox (Advanced Threat Protection)

ده جهاز بيعمل بيئة افتراضية معزولة (Sandbox) عشان يحلل الملفات المشبوهة اللي ممكن تكون فيروسات جديدة لسه محدش يعرفها. بيشغل الملف في البيئة دي ويشوف بيعمل إيه، لو لقى سلوك مشبوه بيعرف إنه فيروس وبيمنعه.

### 1.3.8 FortiAuthenticator (Identity & Access Management)

لإدارة المصادقة (Authentication) والترخيص (Authorization) للمستخدمين، ويدعم المصادقة الثنائية (Two-Factor Authentication - 2FA).

### 1.3.9 FortiSwitch (Secure Ethernet Switches)

سويتشات شبكة بتشتغل مع FortiGate عشان توفر أمان متكامل على مستوى الشبكة الداخلية.

### 1.3.10 FortiAP (Wireless Access Points)

نقاط وصول لاسلكية (Wi-Fi Access Points) بتشتغل مع FortiGate عشان توفر شبكة لاسلكية آمنة ومتحكم فيها.

## الخلاصة

في الفصل ده، أخدنا فكرة عامة عن FortiGate وأهميته في عالم أمن الشبكات. عرفنا إنه مش مجرد جدار حماية، ده حل أمني متكامل بيجمع وظائف كتير في جهاز واحد. كمان، بصينا على تاريخ Fortinet وإزاي تطورت، وعرفنا عائلة منتجاتها اللي بتشتغل مع بعضها عشان توفر حماية شاملة.

الفهم ده هيساعدنا جداً في الفصول الجاية لما ندخل في التفاصيل التقنية لكل ميزة. دلوقتي أنت جاهز إنك تكمل رحلتك في عالم FortiGate وتتعلم إزاي تأمن شبكتك زي المحترفين!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الثاني: التكوين الأساسي (Basic Configuration)

## نظرة عامة على الفصل

بعد ما أخدنا فكرة عامة عن FortiGate في الفصل اللي فات، دلوقتي جه وقت الجد! في الفصل ده، هنبدأ نخش في التكوين العملي لجهاز FortiGate. هنعرف إزاي نعمل الإعدادات الأولية للجهاز، وإزاي نكون الواجهات (Interfaces) بتاعته، اللي هي بوابات الدخول والخروج للشبكة. كمان، هنتعلم إزاي نعمل شبكات VLANs، اللي بتساعدنا نقسم الشبكة بتاعتنا لأجزاء أصغر وأكتر أماناً.

هنتكلم كمان عن الـ Virtual Domains (VDOMs)، ودي ميزة قوية في FortiGate بتخليك تقسم جهاز واحد لأكتر من جدار حماية افتراضي، كأنك عندك أكتر من جهاز فيزيائي. وهنشوف إزاي نتحكم في الوصول الإداري للجهاز، وإزاي نعمل تحديثات للـ Firmware عشان نضمن إن الجهاز بتاعنا شغال بأحدث إصدار وأكتر أماناً.

الفصل ده هو الأساس اللي هتبني عليه كل شغلك بعد كده على FortiGate، فركز كويس في كل خطوة!

## 2.1 الإعدادات الأولية (Initial Setup)

### 2.1.1 الوصول إلى FortiGate

أول ما بتشغل جهاز FortiGate لأول مرة، بيكون ليه إعدادات افتراضية عشان تقدر توصله وتعمله تكوين:

-   **عنوان IP الافتراضي:** `192.168.1.99/24` على منفذ `port1`.
-   **اسم المستخدم الافتراضي:** `admin`.
-   **كلمة المرور الافتراضية:** لا يوجد كلمة مرور (فارغة).

**خطوات الوصول الأولية:**
1.  وصل جهاز الكمبيوتر بتاعك بمنفذ `port1` على FortiGate.
2.  اعمل إعدادات الـ IP على كارت الشبكة بتاع الكمبيوتر بتاعك في نفس الشبكة (مثلاً: `192.168.1.100/24`).
3.  افتح المتصفح بتاعك واكتب `https://192.168.1.99`.
4.  هتظهرلك صفحة تسجيل الدخول، دخل `admin` وسيب كلمة المرور فاضية.
5.  أول ما تدخل، هيطلب منك تغير كلمة المرور، ودي خطوة مهمة جداً للأمان.

### 2.1.2 وضع التشغيل (Operation Mode)

FortiGate ممكن يشتغل في وضعين رئيسيين:

-   **وضع البوابة (NAT/Route Mode):**
    -   ده الوضع الأكثر شيوعاً. FortiGate بيشتغل كـ Router وجدار حماية بين الشبكات المختلفة (زي الشبكة الداخلية والإنترنت).
    -   بيعمل Network Address Translation (NAT) عشان يسمح للأجهزة الداخلية بالوصول للإنترنت باستخدام IP عام واحد.
    -   مناسب لمعظم سيناريوهات الشركات.

-   **وضع الشفافية (Transparent Mode):**
    -   FortiGate بيشتغل كـ Bridge أو Layer 2 Firewall. بيتم وضعه في مسار حركة المرور بدون ما يغير أي عناوين IP.
    -   بيكون شفاف للشبكة، يعني الأجهزة اللي وراه مش بتحس بوجوده.
    -   مناسب لو عايز تضيف FortiGate لشبكة موجودة من غير ما تغير في إعدادات الـ IP بتاعتها.

**تغيير وضع التشغيل (CLI):**
```
config system settings
    set opmode transparent # أو set opmode nat
end
```

**مقارنة بـ Cisco:**

Cisco ASA أيضاً بيدعم وضعين مشابهين: Routed Mode (مكافئ لـ NAT/Route Mode) و Transparent Mode. المفهوم واحد، لكن طريقة التكوين بتختلف.

## 2.2 تكوين الواجهات (Interface Configuration)

الواجهات هي نقاط الاتصال بين FortiGate والشبكات الأخرى. كل واجهة بيكون ليها IP Address، وبتكون مرتبطة بشبكة معينة (LAN, WAN, DMZ).

### 2.2.1 أنواع الواجهات

-   **واجهات فيزيائية (Physical Interfaces):** المنافذ المادية على الجهاز (مثلاً: port1, port2).
-   **واجهات VLAN (VLAN Interfaces):** واجهات منطقية بتتعمل فوق الواجهات الفيزيائية عشان نقسم الشبكة الواحدة لأكتر من شبكة افتراضية (VLAN).
-   **واجهات برمجية (Software Switch/Zone):** تجميع أكتر من واجهة فيزيائية أو منطقية في مجموعة واحدة عشان نطبق عليها سياسات أمنية موحدة.

### 2.2.2 تكوين واجهة فيزيائية (مثال: WAN Interface)

**عبر GUI:**
1.  انتقل إلى **(Network) -> (Interfaces)**.
2.  اختر الواجهة اللي عايز تعملها تكوين (مثلاً: `wan1`).
3.  **Role:** `WAN`.
4.  **Addressing Mode:** `Manual` (لو هتحط IP يدوي) أو `DHCP` (لو هياخد IP من مزود الخدمة).
5.  **IP/Netmask:** دخل عنوان الـ IP والـ Subnet Mask.
6.  **Administrative Access:** حدد الخدمات اللي هتسمح بالوصول ليها على الواجهة دي (مثلاً: `HTTPS`, `SSH`, `Ping`).

**عبر CLI:**
```
config system interface
    edit "wan1"
        set mode static
        set ip 203.0.113.2/24
        set allowaccess ping https ssh
        set role wan
    next
end
```

### 2.2.3 تكوين واجهة VLAN

**عبر GUI:**
1.  انتقل إلى **(Network) -> (Interfaces)**.
2.  انقر على **(Create New) -> (Interface)**.
3.  **Interface Type:** `VLAN`.
4.  **Physical Interface:** اختر الواجهة الفيزيائية اللي الـ VLAN هيتعمل عليها (مثلاً: `port2`).
5.  **VLAN ID:** دخل رقم الـ VLAN (مثلاً: `10`).
6.  **Role:** `LAN`.
7.  **Addressing Mode:** `Manual`.
8.  **IP/Netmask:** دخل عنوان الـ IP والـ Subnet Mask للـ VLAN (مثلاً: `192.168.10.1/24`).
9.  **Administrative Access:** حدد الخدمات المسموحة.

**عبر CLI:**
```
config system interface
    edit "vlan10"
        set vlanid 10
        set interface "port2"
        set ip 192.168.10.1/24
        set allowaccess ping https
        set role lan
    next
end
```

**مقارنة بـ Cisco:**

مفهوم الـ VLANs هو نفسه في Cisco. في Cisco، بتعمل Sub-interfaces على الـ Router أو الـ Layer 3 Switch، وبتعملها Encapsulation Dot1Q مع الـ VLAN ID. FortiGate بيعمل نفس الوظيفة ولكن بطريقة تكوين مختلفة.

## 2.3 النطاقات الافتراضية (Virtual Domains - VDOMs)

### 2.3.1 مفهوم VDOMs

VDOMs هي ميزة قوية في FortiGate بتسمحلك بتقسيم جهاز FortiGate واحد لأكتر من جدار حماية افتراضي مستقل. كل VDOM بيكون ليه سياساته الخاصة، واجهاته، وجداوله التوجيه، ومستخدميه، كأنه جهاز FortiGate منفصل تماماً.

**متى نستخدم VDOMs؟**
-   **مزودي الخدمة (Service Providers):** عشان يقدموا خدمات أمنية لعملاء مختلفين على نفس الجهاز.
-   **الشركات الكبيرة:** لتقسيم الشبكة لأقسام مستقلة (مثلاً: قسم المبيعات، قسم الموارد البشرية، شبكة الضيوف).
-   **البيئات متعددة المستأجرين (Multi-tenant Environments):** لتقديم خدمات أمنية لكيانات مختلفة داخل نفس المنظمة.

### 2.3.2 تكوين VDOMs

**الخطوة 1: تفعيل VDOMs (CLI):**

VDOMs بتكون غير مفعلة بشكل افتراضي. عشان تفعلها، لازم تدخل على الـ CLI.

```
config system global
    set vdom-mode multiple
end
```

**الخطوة 2: إنشاء VDOM جديد (GUI):**
1.  بعد تفعيل VDOMs، هتلاقي خيار جديد ظهر في الـ GUI تحت **(System) -> (VDOM)**.
2.  انقر على **(Create New)**.
3.  أدخل اسم الـ VDOM (مثلاً: `Sales_VDOM`).
4.  حدد الواجهات اللي هتكون جزء من الـ VDOM ده.

**عبر CLI:**
```
config vdom
    edit "Sales_VDOM"
    next
end
```

**الخطوة 3: تخصيص الموارد للـ VDOM:**

يمكنك تخصيص موارد الجهاز (CPU, Memory, Sessions) لكل VDOM لضمان الأداء.

**مقارنة بـ Cisco:**

Cisco ASA عندها مفهوم مشابه اسمه Contexts، بيسمح بتقسيم جهاز ASA واحد لأكتر من جدار حماية افتراضي. المفهوم واحد، لكن طريقة التكوين بتختلف.

## 2.4 الوصول الإداري (Administrative Access)

### 2.4.1 طرق الوصول الإداري

يمكنك الوصول إلى FortiGate لإدارته بعدة طرق:

-   **واجهة المستخدم الرسومية (GUI - HTTPS):** الطريقة الأكثر شيوعاً وسهولة.
-   **واجهة سطر الأوامر (CLI - SSH/Telnet):** للتحكم الدقيق والتكوينات المتقدمة.
-   **Console Port:** للوصول المباشر للجهاز في حالة عدم توفر الشبكة.

### 2.4.2 تأمين الوصول الإداري

تأمين الوصول الإداري لـ FortiGate أمر بالغ الأهمية:

-   **تغيير كلمة المرور الافتراضية:** أول خطوة بعد تسجيل الدخول لأول مرة.
-   **استخدام HTTPS و SSH فقط:** تجنب استخدام HTTP و Telnet لأنها غير مشفرة.
-   **تقييد الوصول على واجهات محددة:** اسمح بالوصول الإداري فقط على الواجهات الموثوقة (مثلاً: LAN أو Management Interface).
-   **تقييد الوصول لعناوين IP محددة:** اسمح فقط لعناوين IP معينة بالوصول الإداري.
-   **تفعيل المصادقة الثنائية (2FA):** إضافة طبقة أمان إضافية للمسؤولين.
-   **استخدام حسابات مستخدمين منفصلة:** لكل مسؤول حساب خاص به بدلاً من استخدام حساب `admin` الافتراضي.

**تكوين الوصول الإداري على واجهة (CLI):**
```
config system interface
    edit "lan"
        set allowaccess ping https ssh http # مثال: السماح بـ HTTPS و SSH
    next
end
```

**تكوين المستخدمين الإداريين (CLI):**
```
config system admin
    edit "new_admin"
        set password "SecurePassword!"
        set accprofile "super_admin" # تحديد صلاحيات المستخدم
        set vdom "root" # تحديد الـ VDOM الذي يمكن للمستخدم إدارته
        set trusthost 192.168.1.0 255.255.255.0 # السماح بالوصول من شبكة معينة
    next
end
```

## 2.5 إدارة التكوين (Configuration Management)

### 2.5.1 حفظ واستعادة التكوين

من المهم جداً حفظ نسخة احتياطية من تكوين FortiGate بانتظام، عشان لو حصل أي مشكلة تقدر ترجع للتكوين اللي كان شغال.

**حفظ التكوين (GUI):**
1.  انتقل إلى **(System) -> (Configuration) -> (Backup)**.
2.  اختر حفظ التكوين على جهاز الكمبيوتر بتاعك.

**حفظ التكوين (CLI):**
```
execute backup config ftp <filename> <ftp_server_ip> <username> <password>
execute backup config tftp <filename> <tftp_server_ip>
```

**استعادة التكوين (GUI):**
1.  انتقل إلى **(System) -> (Configuration) -> (Restore)**.
2.  اختر ملف التكوين اللي عايز تستعيده.

**استعادة التكوين (CLI):**
```
execute restore config ftp <filename> <ftp_server_ip> <username> <password>
execute restore config tftp <filename> <tftp_server_ip>
```

### 2.5.2 مراجعة التكوين (Configuration Audit)

FortiGate بيوفر أدوات لمراجعة التكوين وتحديد أي تغييرات حصلت.

-   **Configuration Revisions:** بيحتفظ بنسخ من التكوين كل ما يحصل تغيير، وتقدر ترجع لأي نسخة سابقة.
-   **Audit Logs:** بيسجل مين عمل إيه وإمتى على الجهاز.

## 2.6 إدارة البرامج الثابتة (Firmware Management)

### 2.6.1 أهمية تحديث الـ Firmware

تحديث الـ Firmware (نظام التشغيل) لـ FortiGate أمر حيوي لـ:
-   **الأمان:** سد الثغرات الأمنية المكتشفة.
-   **الميزات الجديدة:** الحصول على ميزات ووظائف جديدة.
-   **تحسين الأداء:** تحسين أداء الجهاز واستقراره.

### 2.6.2 خطوات تحديث الـ Firmware

**الخطوة 1: تحميل الـ Firmware:**

حمل أحدث إصدار من الـ Firmware من موقع Fortinet الرسمي (Support Portal).

**الخطوة 2: النسخ الاحتياطي للتكوين:**

**مهم جداً:** قبل أي تحديث للـ Firmware، لازم تاخد نسخة احتياطية من التكوين الحالي للجهاز.

**الخطوة 3: التحديث (GUI):**
1.  انتقل إلى **(System) -> (Firmware)**.
2.  انقر على **(Upload Firmware)**.
3.  اختر ملف الـ Firmware اللي حملته.
4.  الجهاز هيعمل إعادة تشغيل بعد التحديث.

**عبر CLI:**
```
execute restore image ftp <filename> <ftp_server_ip> <username> <password>
execute restore image tftp <filename> <tftp_server_ip>
```

**مقارنة بـ Cisco:**

عملية تحديث الـ IOS (نظام التشغيل) في أجهزة Cisco مشابهة: تحميل الـ IOS، أخذ نسخة احتياطية من التكوين، ثم تحديث الجهاز. المفهوم واحد، لكن الأوامر والملفات بتختلف.

## 2.7 خدمات FortiGuard (FortiGuard Services)

### 2.7.1 ما هي خدمات FortiGuard؟

خدمات FortiGuard هي مجموعة من خدمات الأمان القائمة على الاشتراك، بتقدمها Fortinet عشان تحمي أجهزة FortiGate من أحدث التهديدات. الخدمات دي بيتم تحديثها باستمرار من FortiGuard Labs، اللي بتراقب التهديدات العالمية 24/7.

**أمثلة على خدمات FortiGuard:**
-   **Antivirus Updates:** تحديثات لتوقيعات الفيروسات.
-   **IPS Updates:** تحديثات لتوقيعات أنظمة منع التسلل.
-   **Web Filtering:** قاعدة بيانات لتصنيف المواقع وحظر المواقع الضارة.
-   **Application Control:** قاعدة بيانات للتعرف على التطبيقات والتحكم فيها.
-   **Anti-Spam:** حماية ضد رسائل البريد المزعج.
-   **Security Rating:** تقييم أمني لتكوين FortiGate.

### 2.7.2 تفعيل خدمات FortiGuard

بعد شراء الاشتراك، بيتم تفعيل الخدمات تلقائياً على FortiGate. لازم تتأكد إن الجهاز متصل بالإنترنت عشان يقدر يستقبل التحديثات.

**التحقق من حالة FortiGuard (GUI):**
1.  انتقل إلى **(System) -> (FortiGuard)**.
2.  هتلاقي حالة كل خدمة (مفعلة، منتهية الصلاحية، إلخ).

**عبر CLI:**
```
get system fortiguard
```

## الخلاصة

في الفصل ده، أخدنا أولى خطواتنا العملية في تكوين FortiGate. عرفنا إزاي نعمل الإعدادات الأولية، ونكون الواجهات، ونقسم الشبكة باستخدام VLANs و VDOMs. كمان، اتعلمنا إزاي نأمن الوصول الإداري للجهاز، وإزاي نعمل نسخ احتياطية للتكوين، ونحدث الـ Firmware، ونستفيد من خدمات FortiGuard الأمنية.

الفصل ده هو حجر الأساس لأي تكوين على FortiGate. لو فهمت المفاهيم دي كويس وطبقتها عملي، هتكون جاهز إنك تدخل في الفصول الجاية اللي هنتكلم فيها عن سياسات جدار الحماية والميزات الأمنية المتقدمة. يلا بينا نكمل رحلتنا في عالم FortiGate!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الثالث: سياسات جدار الحماية (Firewall Policies)

## نظرة عامة على الفصل

يا جماعة، لو FortiGate ده هو قلب الشبكة، يبقى سياسات جدار الحماية (Firewall Policies) هي الشرايين اللي بتتحكم في كل حركة مرور البيانات جوه القلب ده. الفصل ده هو الأهم في المنهج كله، لأنه بيشرح إزاي FortiGate بياخد قرارات السماح أو الرفض لحركة المرور، وإزاي بنقدر نتحكم في ده.

هنتكلم بالتفصيل عن أنواع السياسات المختلفة، وإزاي بنكونها خطوة بخطوة. هنفهم إيه هي مكونات السياسة الواحدة (المصدر، الوجهة، الخدمة، الإجراء)، وإزاي ترتيب السياسات بيأثر على الأمان والأداء. كمان، هنتعمق في مفهوم الـ NAT (Network Address Translation) اللي بيخلي شبكتك الداخلية تتكلم مع الإنترنت، وهنشوف إزاي FortiGate بيطبق الـ Security Profiles (زي Antivirus و IPS) على السياسات دي.

الفصل ده هو اللي هيخليك تتحكم في FortiGate بجد، وتأمن شبكتك صح. ركز معايا في كل كلمة، عشان ده مفتاح فهم FortiGate كله!

## 3.1 مقدمة إلى سياسات جدار الحماية

### 3.1.1 ما هي سياسة جدار الحماية؟

سياسة جدار الحماية هي مجموعة من القواعد اللي بتحدد إذا كانت حركة مرور معينة مسموح بيها تعدي من FortiGate ولا لأ. كل سياسة بتتكون من مجموعة من المعايير، لو حركة المرور طابقت المعايير دي، بيتم تطبيق الإجراء المحدد في السياسة.

**المبدأ الأساسي:**

FortiGate بيراجع السياسات بالترتيب، من فوق لتحت. أول سياسة تطابق حركة المرور، بيتم تطبيقها، وباقي السياسات مش بتتبص عليها. عشان كده، ترتيب السياسات مهم جداً.

### 3.1.2 المكونات الأساسية للسياسة

كل سياسة جدار حماية بتتكون من المكونات دي:

-   **Incoming Interface (الواجهة الواردة):** الواجهة اللي حركة المرور جاية منها (مثلاً: `lan`).
-   **Outgoing Interface (الواجهة الصادرة):** الواجهة اللي حركة المرور رايحة ليها (مثلاً: `wan1`).
-   **Source (المصدر):** مين اللي بيبعت حركة المرور (IP Address، شبكة، مجموعة مستخدمين).
-   **Destination (الوجهة):** مين اللي بيستقبل حركة المرور (IP Address، شبكة، Virtual IP).
-   **Service (الخدمة):** نوع حركة المرور (HTTP, HTTPS, DNS, Custom Port).
-   **Action (الإجراء):** إيه اللي هيحصل لحركة المرور دي (قبول `Accept`، رفض `Deny`، أو رفض مع إرسال رسالة `Deny (with reset)`).
-   **Security Profiles (ملفات تعريف الأمان):** ميزات أمنية إضافية زي Antivirus, IPS, Web Filter, Application Control.
-   **NAT (Network Address Translation):** تفعيل أو تعطيل الـ NAT.

### 3.1.3 مبدأ الرفض الضمني (Implicit Deny)

ده مبدأ أمني مهم جداً: لو حركة المرور لم تطابق أي سياسة من السياسات اللي أنت مكونها، FortiGate بيرفضها تلقائياً. دي سياسة افتراضية موجودة في آخر قائمة السياسات ومش بتظهرلك، لكنها شغالة دايماً عشان تضمن إن أي حاجة مش مسموح بيها صراحة، هتترفض.

**مقارنة بـ Cisco:**

نفس المبدأ موجود في Cisco ASA و Router Access-lists. دايماً بيكون فيه `deny any any` ضمني في آخر الـ Access-list. ده بيأكد على أهمية إنك تسمح بس باللي أنت عايزه، وترفض أي حاجة تانية.

## 3.2 أنواع السياسات

FortiGate بيسمحلك تكون أنواع مختلفة من السياسات بناءً على حركة المرور:

-   **IPv4 Policy:** للتحكم في حركة مرور IPv4 (الأكثر شيوعاً).
-   **IPv6 Policy:** للتحكم في حركة مرور IPv6.
-   **Multicast Policy:** للتحكم في حركة مرور الـ Multicast.
-   **Local In Policy:** للتحكم في حركة المرور الموجهة لـ FortiGate نفسه (زي الوصول الإداري).

## 3.3 تكوين سياسة جدار حماية (مثال: السماح بالوصول للإنترنت)

هنعمل سياسة بسيطة تسمح للمستخدمين في الشبكة الداخلية (LAN) بالوصول للإنترنت.

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Firewall Policy) -> (IPv4 Policy)**.
2.  انقر على **(Create New)**.
3.  **Name:** `Allow_LAN_to_Internet` (اسم وصفي للسياسة).
4.  **Incoming Interface:** `lan` (الواجهة اللي جاي منها الترافيك).
5.  **Outgoing Interface:** `wan1` (الواجهة اللي رايح ليها الترافيك).
6.  **Source:** `all` (أو مجموعة عناوين IP محددة من الشبكة الداخلية).
7.  **Destination:** `all` (أو مجموعة عناوين IP محددة على الإنترنت).
8.  **Service:** `HTTP`, `HTTPS`, `DNS` (أو `all` لو عايز تسمح بكل الخدمات).
9.  **Action:** `ACCEPT`.
10. **NAT:** تأكد إن `NAT` مفعل (عشان الأجهزة الداخلية تطلع بـ IP الـ WAN).
11. **Security Profiles:** ممكن تفعل Antivirus, IPS, Web Filter, Application Control هنا (هنتكلم عنهم بالتفصيل في فصل Security Profiles).
12. **Logging Options:** `Log Allowed Traffic` (عشان تسجل حركة المرور المسموح بيها).
13. انقر على **(OK)**.

**عبر CLI:**
```
config firewall policy
    edit 0 # أو رقم سياسة جديد
        set name "Allow_LAN_to_Internet"
        set srcintf "lan"
        set dstintf "wan1"
        set srcaddr "all"
        set dstaddr "all"
        set service "HTTP" "HTTPS" "DNS"
        set action accept
        set nat enable
        set logtraffic all
    next
end
```

## 3.4 ترتيب السياسات (Policy Order and Optimization)

زي ما قلنا، FortiGate بيراجع السياسات بالترتيب من فوق لتحت. ده بيخلي ترتيب السياسات عامل حاسم في الأمان والأداء.

### 3.4.1 قواعد ترتيب السياسات

-   **السياسات الأكثر تحديداً أولاً (Most Specific First):** السياسات اللي بتحدد حركة مرور معينة جداً (مثلاً: IP واحد ومنفذ واحد) لازم تكون قبل السياسات العامة (مثلاً: أي IP وأي منفذ).
-   **سياسات الرفض قبل سياسات السماح (Deny Before Allow):** لو عايز تمنع حركة مرور معينة، لازم تحط سياسة الرفض بتاعتها قبل أي سياسة سماح ممكن تطابق نفس حركة المرور دي.
-   **السياسات الأكثر استخداماً أولاً (Most Used First):** السياسات اللي بيتم استخدامها كتير، يفضل تكون في الأول عشان FortiGate ميضطرش يراجع سياسات كتير قبل ما يلاقي تطابق.

### 3.4.2 مثال على ترتيب السياسات

تخيل إنك عايز تمنع مستخدم معين (IP: 192.168.1.50) من الوصول للفيسبوك، لكن تسمح لباقي الشبكة بالوصول للإنترنت عادي.

**الترتيب الصحيح:**
1.  **Deny_User_Facebook:** (Source: 192.168.1.50, Destination: Facebook, Service: HTTPS, Action: DENY)
2.  **Allow_LAN_to_Internet:** (Source: LAN, Destination: all, Service: all, Action: ACCEPT)

لو عكست الترتيب، سياسة `Allow_LAN_to_Internet` هتطابق حركة مرور الفيسبوك للمستخدم ده، وهتسمح بيها قبل ما سياسة الرفض تيجي، وبالتالي مش هتشتغل.

**مقارنة بـ Cisco:**

نفس المفهوم في Cisco Access-lists. الأوامر بتتم معالجتها بالترتيب، وأول تطابق بيتم تطبيقه. عشان كده، لازم تحط الـ `deny` الأكثر تحديداً قبل الـ `permit` الأكثر عمومية.

## 3.5 ترجمة عنوان الشبكة (Network Address Translation - NAT)

### 3.5.1 مفهوم NAT

NAT هي عملية تغيير عناوين IP المصدر أو الوجهة لحركة المرور أثناء مرورها عبر FortiGate. بنستخدم الـ NAT عشان:

-   **Source NAT (SNAT):** لما الأجهزة الداخلية (اللي ليها Private IPs) بتحاول توصل للإنترنت (اللي بيحتاج Public IPs). FortiGate بيغير الـ Private IP بتاع الجهاز الداخلي لـ Public IP بتاع FortiGate (غالباً الـ IP بتاع واجهة الـ WAN).
-   **Destination NAT (DNAT) / Virtual IP (VIP):** لما حد من الإنترنت بيحاول يوصل لسيرفر موجود جوه الشبكة الداخلية (اللي ليه Private IP). FortiGate بيغير الـ Public IP اللي الناس بتحاول توصله لـ Private IP بتاع السيرفر الداخلي.

### 3.5.2 تكوين Source NAT (SNAT)

SNAT بيتم تفعيله في سياسة جدار الحماية نفسها.

**عبر GUI:**
1.  في سياسة جدار الحماية (زي `Allow_LAN_to_Internet` اللي عملناها قبل كده).
2.  في قسم **(NAT)**، فعل خيار **(Use Outgoing Interface Address)**. ده بيخلي FortiGate يستخدم الـ IP بتاع واجهة الـ Outgoing (اللي هي `wan1` في المثال بتاعنا) كـ Source IP لحركة المرور اللي طالعة للإنترنت.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set nat enable
    next
end
```

### 3.5.3 تكوين Destination NAT (DNAT) / Virtual IP (VIP)

VIP بيستخدم عشان يسمح بالوصول لسيرفرات داخلية من الإنترنت.

**الخطوة 1: إنشاء Virtual IP (GUI):**
1.  انتقل إلى **(Policy & Objects) -> (Virtual IPs)**.
2.  انقر على **(Create New) -> (Virtual IP)**.
3.  **Name:** `Web_Server_VIP`.
4.  **External IP Address/Range:** الـ Public IP اللي الناس هتوصل بيه من الإنترنت (مثلاً: `203.0.113.10`).
5.  **Mapped IP Address/Range:** الـ Private IP بتاع السيرفر الداخلي (مثلاً: `192.168.1.200`).
6.  **Port Forwarding:** لو عايز توجه بورت معين (مثلاً: `HTTP` أو `HTTPS`).

**عبر CLI:**
```
config firewall vip
    edit "Web_Server_VIP"
        set extip 203.0.113.10
        set mappedip "192.168.1.200"
        set extintf "wan1"
        set portforward enable
        set protocol tcp
        set mappedport 80
        set extport 80
    next
end
```

**الخطوة 2: استخدام Virtual IP في سياسة جدار الحماية (GUI):**
1.  انتقل إلى **(Policy & Objects) -> (Firewall Policy) -> (IPv4 Policy)**.
2.  انقر على **(Create New)**.
3.  **Incoming Interface:** `wan1`.
4.  **Outgoing Interface:** `lan` (أو الواجهة اللي عليها السيرفر).
5.  **Source:** `all`.
6.  **Destination:** `Web_Server_VIP` (الـ VIP اللي لسه عاملينه).
7.  **Service:** `HTTP`, `HTTPS`.
8.  **Action:** `ACCEPT`.
9.  **NAT:** تأكد إن `NAT` غير مفعل (لأن الـ VIP هو اللي بيعمل الـ NAT).

**مقارنة بـ Cisco:**

Cisco ASA بيستخدم Static NAT أو Port Address Translation (PAT) لنفس الغرض. المفهوم هو نفسه: ترجمة عناوين IP للسماح بالاتصال بين الشبكات المختلفة. FortiGate بيسهل الموضوع ده عن طريق الـ VIPs.

## 3.6 ملفات تعريف الأمان (Security Profiles)

### 3.6.1 مفهوم Security Profiles

Security Profiles هي مجموعة من الميزات الأمنية المتقدمة اللي FortiGate بيطبقها على حركة المرور اللي بتعدي من خلاله. دي اللي بتخلي FortiGate جدار حماية من الجيل التالي (NGFW) أو UTM. بتشمل:

-   **Antivirus:** بيكتشف ويمنع الفيروسات والبرامج الضارة.
-   **Intrusion Prevention System (IPS):** بيكتشف ويمنع محاولات الاختراق والهجمات.
-   **Web Filter:** بيتحكم في تصفح الويب ويمنع الوصول للمواقع الضارة أو غير المرغوب فيها.
-   **Application Control:** بيتعرف على التطبيقات (حتى لو بتستخدم بورتات غير قياسية) ويتحكم فيها.
-   **Data Leakage Prevention (DLP):** بيمنع تسرب البيانات الحساسة خارج الشبكة.
-   **SSL/SSH Inspection:** بيفحص حركة المرور المشفرة (HTTPS, SSH) عشان يكتشف التهديدات المخفية جواها.

### 3.6.2 ربط Security Profiles بسياسة جدار الحماية

عشان FortiGate يطبق الـ Security Profiles دي، لازم تفعلها في سياسة جدار الحماية.

**عبر GUI:**
1.  في سياسة جدار الحماية (زي `Allow_LAN_to_Internet`).
2.  في قسم **(Security Profiles)**، فعل الميزات اللي عايزها (Antivirus, IPS, Web Filter, Application Control, SSL/SSH Inspection).
3.  لكل ميزة، اختار الـ Profile المناسب (ممكن تستخدم الـ Profile الافتراضي أو تعمل Profile مخصص).

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set av-profile "default"
        set ips-sensor "default"
        set webfilter-profile "default"
        set application-list "default"
        set ssl-ssh-profile "deep-inspection"
    next
end
```

**مقارنة بـ Cisco:**

في Cisco Firepower NGFW، بتستخدم Access Control Policies عشان تربط ميزات الأمان المتقدمة (زي AMP, IPS, URL Filtering, Application Control) بحركة المرور. المفهوم هو نفسه: تطبيق حماية متعددة الطبقات على الترافيك.

## الخلاصة

الفصل ده كان هو قلب المنهج! دلوقتي أنت فهمت إزاي سياسات جدار الحماية بتشتغل على FortiGate، وإزاي تتحكم في حركة المرور بشكل كامل. عرفت إيه هي مكونات السياسة، وإزاي ترتيبها مهم جداً، وإزاي الـ NAT بيخلي شبكتك تتكلم مع العالم الخارجي.

الأهم من ده كله، إنك فهمت إزاي تربط الـ Security Profiles بالسياسات عشان FortiGate يقدر يوفر حماية متكاملة ضد أحدث التهديدات. لو قدرت تستوعب الفصل ده كويس وتطبقه عملي، فأنت قطعت شوط كبير جداً في طريقك لتكون خبير FortiGate.

يلا بينا على الفصل اللي جاي عشان نكمل رحلتنا في عالم FortiGate المثير!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الرابع: المصادقة (Authentication)

## نظرة عامة على الفصل

يا جماعة، بعد ما فهمنا إزاي FortiGate بيتحكم في حركة المرور بالـ Firewall Policies، دلوقتي جه وقت نتكلم عن مين اللي مسموحله يعدي أصلاً! الفصل ده هيركز على المصادقة (Authentication)، يعني إزاي FortiGate بيتحقق من هوية المستخدمين قبل ما يسمحلهم بالوصول لموارد الشبكة.

هنتكلم عن أنواع المصادقة المختلفة اللي FortiGate بيدعمها، زي المستخدمين المحليين (Local Users)، والمصادقة عن طريق خوادم خارجية زي RADIUS و LDAP (اللي ممكن تكون Active Directory). كمان، هنتعمق في المصادقة الثنائية (Two-Factor Authentication - 2FA) باستخدام FortiToken، ودي حاجة مهمة جداً لزيادة الأمان. وهنشوف إزاي نربط المستخدمين دول بسياسات جدار الحماية عشان نتحكم في صلاحياتهم.

الفصل ده مهم جداً عشان تأمن الوصول لشبكتك، وتضمن إن اللي بيدخلها هو بس اللي مسموحله يدخل. يلا بينا نشوف إزاي FortiGate بيعمل كل ده!

## 4.1 المستخدمون والمجموعات المحلية (Local Users and Groups)

### 4.1.1 مفهوم المستخدمين المحليين

المستخدمون المحليون (Local Users) هم حسابات مستخدمين بيتم إنشاؤها وتخزينها مباشرة على جهاز FortiGate نفسه. دي طريقة بسيطة للمصادقة، ومناسبة للشبكات الصغيرة أو للمستخدمين الإداريين.

**متى نستخدم المستخدمين المحليين؟**
-   للمسؤولين اللي بيديروا FortiGate.
-   لعدد قليل من المستخدمين اللي بيحتاجوا وصول خاص (مثلاً: مستخدمي VPN).
-   في البيئات اللي مفيش فيها خادم مصادقة مركزي (زي Active Directory).

### 4.1.2 تكوين مستخدم محلي (Local User)

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (User Definition)**.
2.  انقر على **(Create New)**.
3.  **Type:** `Local User`.
4.  **User Name:** اسم المستخدم (مثلاً: `vpn_user`).
5.  **Password:** كلمة المرور.
6.  ممكن تحدد صلاحيات معينة للمستخدم ده (مثلاً: وصول VPN فقط).

**عبر CLI:**
```
config user local
    edit "vpn_user"
        set type password
        set passwd "StrongPassword123!"
    next
end
```

### 4.1.3 تكوين مجموعة مستخدمين محلية (Local User Group)

مجموعات المستخدمين بتسهل إدارة الصلاحيات، بدل ما تطبق سياسة على كل مستخدم لوحده، ممكن تطبقها على مجموعة.

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (User Groups)**.
2.  انقر على **(Create New)**.
3.  **Name:** اسم المجموعة (مثلاً: `VPN_Users_Group`).
4.  **Members:** ضيف المستخدمين المحليين اللي أنشأتهم للمجموعة دي.

**عبر CLI:**
```
config user group
    edit "VPN_Users_Group"
        set member "vpn_user"
    next
end
```

**مقارنة بـ Cisco:**

في Cisco، ممكن تعمل Local Users على الـ Router أو الـ ASA، وتستخدمهم للمصادقة. المفهوم واحد، لكن في الشركات الكبيرة بنفضل نستخدم خوادم مصادقة مركزية زي Active Directory أو RADIUS.

## 4.2 المصادقة عن طريق خوادم خارجية (Remote Authentication)

في الشبكات الكبيرة، بيكون عندنا عدد كبير من المستخدمين، وإدارة حساباتهم على كل جهاز لوحده بتكون مستحيلة. عشان كده بنستخدم خوادم مصادقة مركزية.

### 4.2.1 المصادقة باستخدام RADIUS

RADIUS (Remote Authentication Dial-In User Service) هو بروتوكول مصادقة مركزي شائع جداً. FortiGate بيشتغل كـ RADIUS Client، وبيبعت طلبات المصادقة لخادم RADIUS (زي Microsoft NPS أو Cisco ISE).

**مراحل المصادقة باستخدام RADIUS (مع FortiGate كعميل):**
1.  **المستخدم بيحاول يدخل:** أنت بتحاول توصل لحاجة محمية على الشبكة (زي VPN).
2.  **الـ FortiGate بيطلب منك إثبات هوية:** FortiGate بيستقبل طلبك، وبيبعت اسم المستخدم وكلمة السر لخادم الـ RADIUS.
3.  **خادم الـ RADIUS بيراجع الأوراق:** الـ RADIUS بيتحقق من اسم المستخدم وكلمة السر في قاعدة بياناته (ممكن تكون Active Directory). لو صح، بيبعت رد إيجابي لـ FortiGate، ولو غلط، بيبعت رد سلبي.
4.  **الـ FortiGate بياخد القرار:** بناءً على رد الـ RADIUS، FortiGate بيسمحلك بالدخول أو بيرفض طلبك.

**السر المشترك (Shared Secret):**

عشان FortiGate وخادم الـ RADIUS يثقوا في بعض، لازم يكون بينهم "سر مشترك" (Shared Secret). ده عبارة عن كلمة سر طويلة ومعقدة بتتكون على الجهازين. أي رسالة بتتبعت بين FortiGate والـ RADIUS بتكون متوقعة بالسر ده، عشان نتأكد إن مفيش حد في النص بيحاول يزور الرسائل.

**تكوين خادم RADIUS على FortiGate:**

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (RADIUS Servers)**.
2.  انقر على **(Create New)**.
3.  **Name:** اسم الخادم (مثلاً: `My_RADIUS_Server`).
4.  **Primary Server IP/Name:** عنوان IP لخادم الـ RADIUS.
5.  **Secret:** السر المشترك اللي متكون على خادم الـ RADIUS.

**عبر CLI:**
```
config user radius
    edit "My_RADIUS_Server"
        set server 10.0.0.10 # IP خادم RADIUS
        set secret "MySharedSecret123!"
        set auth-type auto
    next
end
```

**مقارنة بـ Cisco:**

في Cisco، بنستخدم بروتوكول RADIUS بشكل واسع للمصادقة المركزية، خاصة مع Cisco ISE (Identity Services Engine) اللي بيشتغل كخادم RADIUS. نفس مفهوم الـ Shared Secret موجود وضروري لتأمين الاتصال.

### 4.2.2 المصادقة باستخدام LDAP

LDAP (Lightweight Directory Access Protocol) هو بروتوكول بيستخدم للوصول لقواعد بيانات الدليل (Directory Services) زي Microsoft Active Directory. FortiGate ممكن يتصل بـ Active Directory مباشرة عن طريق LDAP عشان يتحقق من هوية المستخدمين.

**تكوين خادم LDAP على FortiGate:**

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (LDAP Servers)**.
2.  انقر على **(Create New)**.
3.  **Name:** اسم الخادم (مثلاً: `My_AD_Server`).
4.  **Server IP/Name:** عنوان IP لـ Domain Controller.
5.  **Common Name Identifier:** `sAMAccountName` (لـ Active Directory).
6.  **Distinguished Name:** الـ DN اللي هيبدأ منه البحث عن المستخدمين (مثلاً: `DC=example,DC=com`).
7.  **Bind Type:** `Regular`.
8.  **User DN:** اسم مستخدم ليه صلاحية البحث في الـ Active Directory (مثلاً: `CN=FortiGate_Bind,CN=Users,DC=example,DC=com`).
9.  **Password:** كلمة مرور المستخدم ده.

**عبر CLI:**
```
config user ldap
    edit "My_AD_Server"
        set server "10.0.0.20"
        set cnid "sAMAccountName"
        set dn "DC=example,DC=com"
        set type regular
        set username "FortiGate_Bind"
        set password "BindPassword123!"
    next
end
```

**مقارنة بـ Cisco:**

Cisco أيضاً بتدعم المصادقة باستخدام LDAP مع Active Directory، وده بيتم تكوينه على أجهزة زي ASA أو Router أو من خلال Cisco ISE.

## 4.3 المصادقة الثنائية (Two-Factor Authentication - 2FA)

### 4.3.1 مفهوم 2FA و FortiToken

المصادقة الثنائية (2FA) بتضيف طبقة أمان إضافية للمصادقة. بدل ما تعتمد على كلمة سر بس، بتطلب من المستخدم حاجة تانية يمتلكها (زي موبايل عليه تطبيق FortiToken) أو حاجة تكون جزء منه (زي بصمة الإصبع).

FortiToken هو حل Fortinet للمصادقة الثنائية، بيولد أكواد مرور لمرة واحدة (One-Time Passwords - OTP) على تطبيق على الموبايل أو جهاز مادي (Hardware Token).

**تكوين FortiToken:**

**الخطوة 1: تفعيل FortiToken على المستخدم (GUI):**
1.  انتقل إلى **(User & Authentication) -> (User Definition)**.
2.  اختر المستخدم اللي عايز تفعل عليه 2FA.
3.  في قسم **(Two-Factor Authentication)**، فعل `Enable Two-Factor Authentication`.
4.  اختر `FortiToken Mobile` أو `FortiToken Hardware`.
5.  لو FortiToken Mobile، هيظهرلك QR Code عشان المستخدم يعمل Scan ليه من التطبيق.

**عبر CLI:**
```
config user local
    edit "vpn_user"
        set two-factor fortitoken
        set fortitoken "FTKMOBXXXXXXXXXX" # Serial Number بتاع التوكن
    next
end
```

**مقارنة بـ Cisco:**

Cisco بتوفر حلول 2FA من خلال Cisco Duo Security، أو التكامل مع خوادم RADIUS اللي بتدعم 2FA. المفهوم واحد: إضافة عامل مصادقة تاني لزيادة الأمان.

## 4.4 مجموعات المستخدمين وسياسات المصادقة (User Groups and Authentication Policies)

### 4.4.1 ربط المستخدمين بسياسات جدار الحماية

بعد ما عرفنا المستخدمين (محليين أو من خوادم خارجية)، بنقدر نستخدمهم في سياسات جدار الحماية عشان نتحكم في وصولهم.

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Firewall Policy) -> (IPv4 Policy)**.
2.  انقر على **(Create New)** أو عدّل سياسة موجودة.
3.  في قسم **(Source)**، بدل ما تختار `all`، اختار `User Group` أو `User`، واختار المجموعة أو المستخدم اللي عايز تطبق عليه السياسة.
4.  لما المستخدم ده يحاول يعدي من السياسة دي، FortiGate هيطلب منه المصادقة.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set srcintf "lan"
        set dstintf "wan1"
        set srcaddr "all"
        set dstaddr "all"
        set groups "VPN_Users_Group" # ربط السياسة بمجموعة المستخدمين
        set service "HTTP" "HTTPS"
        set action accept
        set nat enable
    next
end
```

### 4.4.2 سياسات المصادقة (Authentication Policies)

FortiGate بيسمحلك تعمل سياسات مصادقة منفصلة عشان تتحكم في متى وأين يتم طلب المصادقة من المستخدمين.

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Authentication Policy)**.
2.  انقر على **(Create New)**.
3.  حدد الـ Source Interface, Source Address, Destination Interface, Destination Address, Service.
4.  **Action:** `Authenticate`.
5.  **User Group:** اختار مجموعة المستخدمين اللي عايزهم يعملوا مصادقة.

**مقارنة بـ Cisco:**

في Cisco، بنستخدم AAA (Authentication, Authorization, Accounting) عشان نتحكم في الوصول للموارد. ممكن نستخدم Access-lists مع AAA، أو نستخدم Cisco ISE لفرض سياسات وصول معقدة بناءً على هوية المستخدم.

## 4.5 تكامل SAML SSO (Single Sign-On)

### 4.5.1 مفهوم SAML SSO

SAML (Security Assertion Markup Language) هو معيار مفتوح لتبادل بيانات المصادقة والترخيص بين موفر الهوية (Identity Provider - IdP) وموفر الخدمة (Service Provider - SP). الـ SSO (Single Sign-On) بيسمح للمستخدم يسجل دخول مرة واحدة بس، ويقدر يوصل لأكتر من تطبيق أو خدمة من غير ما يسجل دخول تاني.

FortiGate ممكن يشتغل كـ Service Provider، ويتكامل مع IdP زي Azure AD أو Okta عشان يوفر تجربة SSO للمستخدمين.

**مراحل SAML SSO:**
1.  **المستخدم بيحاول يوصل لـ FortiGate (SP).**
2.  **FortiGate بيوجه المستخدم لـ IdP:** FortiGate بيعرف إن المستخدم ده لازم يعمل مصادقة عن طريق SAML، فبيبعته لـ IdP.
3.  **المستخدم بيعمل مصادقة مع IdP:** المستخدم بيدخل بيانات اعتماده (اسم المستخدم وكلمة السر) على صفحة الـ IdP.
4.  **IdP بيبعت SAML Assertion لـ FortiGate:** لو المصادقة نجحت، الـ IdP بيبعت رسالة مشفرة (SAML Assertion) لـ FortiGate، بتقول إن المستخدم ده تم التحقق من هويته.
5.  **FortiGate بيسمح للمستخدم بالدخول:** FortiGate بيتحقق من الـ SAML Assertion، وبيسمح للمستخدم بالوصول للموارد المطلوبة.

### 4.5.2 تكوين SAML SSO على FortiGate

التكوين معقد شوية وبيحتاج إعدادات على FortiGate وعلى الـ IdP. الخطوات الأساسية:

**الخطوة 1: تكوين IdP على FortiGate:**

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (SAML Providers)**.
2.  انقر على **(Create New)**.
3.  أدخل معلومات الـ IdP (URL, Certificate).

**الخطوة 2: تكوين FortiGate كـ SP على الـ IdP:**

هتحتاج تدخل معلومات FortiGate (SP Entity ID, Assertion Consumer Service URL) على الـ IdP.

**الخطوة 3: ربط SAML User Group بسياسة جدار الحماية:**

هتعمل User Group من نوع SAML وتضيفها لسياسة جدار الحماية زي ما عملنا مع باقي أنواع المستخدمين.

**مقارنة بـ Cisco:**

Cisco أيضاً بتدعم SAML SSO بشكل واسع في منتجاتها المختلفة (زي Cisco ASA, Cisco ISE, Cisco Duo) للتكامل مع IdPs زي Azure AD و Okta.

## 4.6 إدارة الضيوف (Guest Management)

### 4.6.1 مفهوم إدارة الضيوف

إدارة الضيوف هي طريقة لتوفير وصول مؤقت للإنترنت للزوار أو الضيوف في شبكتك، مع الحفاظ على أمان شبكتك الداخلية. FortiGate بيوفر بوابات مصادقة للضيوف (Guest Portals) تسمح للضيوف بالتسجيل والدخول.

**ميزات إدارة الضيوف:**
-   **صفحة تسجيل دخول مخصصة (Customizable Login Page):** ممكن تعمل صفحة تسجيل دخول خاصة بيك.
-   **مصادقة ذاتية (Self-Registration):** الضيوف بيقدروا يسجلوا نفسهم.
-   **وصول مؤقت (Temporary Access):** تحديد مدة زمنية للوصول.
-   **عزل الضيوف (Guest Isolation):** عزل شبكة الضيوف عن شبكة الشركة الداخلية.

### 4.6.2 تكوين Guest Portal

**الخطوة 1: إنشاء Guest User Group:**

**عبر GUI:**
1.  انتقل إلى **(User & Authentication) -> (User Groups)**.
2.  انقر على **(Create New)**.
3.  **Name:** `Guest_Users`.
4.  **Type:** `Guest`.

**الخطوة 2: تكوين Captive Portal على واجهة:**

**عبر GUI:**
1.  انتقل إلى **(Network) -> (Interfaces)**.
2.  اختر الواجهة اللي عليها شبكة الضيوف (مثلاً: `guest_wifi`).
3.  في قسم **(Admission Control)**، فعل `Enable Captive Portal`.
4.  **Authentication Method:** `Local` أو `External`.
5.  **User Group:** اختار `Guest_Users`.

**الخطوة 3: إنشاء Firewall Policy لشبكة الضيوف:**

هتعمل سياسة تسمح لـ `Guest_Users` بالوصول للإنترنت فقط، مع تطبيق Security Profiles المناسبة.

**مقارنة بـ Cisco:**

Cisco أيضاً بتوفر حلول Guest Access من خلال Cisco Wireless LAN Controllers (WLC) و Cisco ISE، مع إمكانية إنشاء Guest Portals مخصصة.

## الخلاصة

في الفصل ده، اتعلمنا إزاي FortiGate بيتعامل مع المصادقة، ودي خطوة أساسية في تأمين أي شبكة. عرفنا أنواع المستخدمين (محليين وخارجيين)، وإزاي نربط FortiGate بـ RADIUS و LDAP عشان نستخدم حسابات المستخدمين الموجودة عندنا.

الأهم من ده كله، إننا فهمنا قوة المصادقة الثنائية (2FA) باستخدام FortiToken، وإزاي بتضيف طبقة أمان إضافية. كمان، عرفنا إزاي نستخدم مجموعات المستخدمين في سياسات جدار الحماية، وإزاي FortiGate بيدعم SAML SSO وإدارة الضيوف.

كل دي ميزات قوية بتخلي FortiGate حل أمني متكامل. دلوقتي أنت جاهز إنك تدخل في عالم الـ VPNs، اللي هيوصلك بشبكتك من أي مكان في العالم بأمان. يلا بينا على الفصل اللي جاي!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الخامس: الشبكات الافتراضية الخاصة (VPNs - Virtual Private Networks)

## نظرة عامة على الفصل

يا شباب، بعد ما فهمنا إزاي FortiGate بيتحكم في حركة المرور وبيعمل مصادقة للمستخدمين، دلوقتي جه وقت نتكلم عن الـ VPNs (Virtual Private Networks). الـ VPNs دي حاجة أساسية جداً في أي شبكة حديثة، خصوصاً مع انتشار العمل عن بُعد والفروع المتعددة للشركات.

في الفصل ده، هنتعمق في أنواع الـ VPNs اللي FortiGate بيدعمها: الـ SSL VPN اللي بيسمح للمستخدمين يوصلوا للشبكة من أي مكان بسهولة، والـ IPsec VPN اللي بيستخدم لربط الفروع ببعضها بشكل آمن. هنشرح كل نوع بالتفصيل، وإزاي تكونه خطوة بخطوة، وإيه هي أفضل الممارسات لكل نوع.

كمان، هنتعلم إزاي نستكشف الأخطاء ونحل المشاكل اللي ممكن تحصل في الـ VPNs. الفصل ده هيخليك تقدر توفر اتصال آمن وموثوق بيه لشبكتك، سواء للموظفين اللي بيشتغلوا من بره، أو لربط فروع الشركة ببعضها. يلا بينا نخش في التفاصيل!

## 5.1 مقدمة إلى VPNs

### 5.1.1 ما هي VPN؟

الـ VPN هي شبكة خاصة افتراضية بتسمحلك تعمل اتصال آمن ومشفّر عبر شبكة عامة (زي الإنترنت). تخيل إنك بتبني نفق سري ومحمي جوه الإنترنت، أي داتا بتعدي جوه النفق ده بتكون مشفرة ومحمية من أي حد بيحاول يتجسس عليها.

**ليه بنستخدم VPN؟**
-   **الأمان (Security):** تشفير البيانات وحمايتها من التنصت.
-   **الخصوصية (Privacy):** إخفاء عنوان IP الحقيقي بتاعك.
-   **الوصول عن بُعد (Remote Access):** السماح للموظفين بالوصول لموارد الشركة من أي مكان.
-   **ربط الفروع (Site-to-Site Connectivity):** ربط فروع الشركة ببعضها بشكل آمن.

### 5.1.2 أنواع VPNs في FortiGate

FortiGate بيدعم نوعين رئيسيين من الـ VPNs:

-   **SSL VPN:**
    -   بيستخدم بروتوكول SSL/TLS (نفس البروتوكول اللي بيستخدم في HTTPS).
    -   سهل الاستخدام للمستخدمين النهائيين، ممكن يوصلوا من أي متصفح ويب أو باستخدام FortiClient.
    -   مناسب للوصول عن بُعد (Remote Access) للمستخدمين الفرديين.
    -   بيشتغل على بورت 443 (أو أي بورت تاني تحدده)، وده بيخليه يعدي من معظم جدران الحماية بسهولة.

-   **IPsec VPN:**
    -   بيستخدم بروتوكول IPsec (Internet Protocol Security).
    -   أكثر تعقيداً في التكوين من SSL VPN، لكنه بيوفر أمان أعلى وأداء أفضل في بعض السيناريوهات.
    -   مناسب لربط الفروع ببعضها (Site-to-Site) أو للوصول عن بُعد (Remote Access) باستخدام FortiClient.

**مقارنة بـ Cisco:**

Cisco أيضاً بتدعم SSL VPN (عن طريق AnyConnect Client) و IPsec VPN (Site-to-Site و Remote Access) على أجهزة ASA و Routers. المفهوم واحد، لكن طريقة التكوين بتختلف.

## 5.2 SSL VPN (الوصول عن بُعد - Remote Access)

### 5.2.1 مفهوم SSL VPN

SSL VPN بيسمح للمستخدمين بالوصول الآمن للشبكة الداخلية من أي مكان باستخدام متصفح ويب (Web Mode) أو برنامج FortiClient (Tunnel Mode). الـ Web Mode بيسمح بالوصول لتطبيقات الويب فقط، أما الـ Tunnel Mode فبيعمل نفق كامل وبيخلي جهاز المستخدم كأنه جزء من الشبكة الداخلية.

### 5.2.2 تكوين SSL VPN

**الخطوة 1: تفعيل SSL VPN على واجهة (GUI):**
1.  انتقل إلى **(VPN) -> (SSL-VPN Settings)**.
2.  **Listen on Interface(s):** اختار الواجهة اللي FortiGate هيستقبل عليها اتصالات الـ VPN (غالباً `wan1`).
3.  **Listen Port:** البورت اللي هيشتغل عليه الـ SSL VPN (الافتراضي 443، ممكن تغيره لـ 10443 مثلاً).
4.  **Server Certificate:** اختار الشهادة اللي هيستخدمها FortiGate (ممكن تستخدم شهادة Fortinet الافتراضية أو شهادة خاصة بيك).

**عبر CLI:**
```
config vpn ssl web portal
    edit "full-access"
        set tunnel-mode enable
        set web-mode enable
        set ip-pools "SSLVPN_TUNNEL_ADDR1"
        set split-tunneling enable
    next
end

config vpn ssl settings
    set sslvpn-enable enable
    set servercert "Fortinet_Factory"
    set tunnel-ip-pools "SSLVPN_TUNNEL_ADDR1"
    set source-interface "wan1"
    set source-address "all"
    set default-portal "full-access"
    set listen-port 10443
end
```

**الخطوة 2: تكوين مجموعة مستخدمين SSL VPN (GUI):**
1.  انتقل إلى **(User & Authentication) -> (User Groups)**.
2.  انقر على **(Create New)**.
3.  **Name:** `SSLVPN_Users`.
4.  **Type:** `Firewall`.
5.  **Members:** ضيف المستخدمين اللي هيستخدموا الـ SSL VPN (ممكن يكونوا Local Users أو من RADIUS/LDAP).

**الخطوة 3: تكوين SSL VPN Portal (GUI):**
1.  انتقل إلى **(VPN) -> (SSL-VPN Portals)**.
2.  انقر على **(Create New)** أو عدّل الـ `full-access` Portal.
3.  **Tunnel Mode:** فعلها لو عايز المستخدمين يستخدموا FortiClient.
4.  **Web Mode:** فعلها لو عايز المستخدمين يوصلوا من المتصفح.
5.  حدد الـ IP Pool اللي هياخد منه المستخدمين IPs لما يتصلوا بالـ VPN.
6.  حدد الموارد اللي هيقدروا يوصلولها (Web Bookmarks, File Shares).

**الخطوة 4: إنشاء سياسة جدار حماية لـ SSL VPN (GUI):**
1.  انتقل إلى **(Policy & Objects) -> (Firewall Policy) -> (IPv4 Policy)**.
2.  انقر على **(Create New)**.
3.  **Name:** `SSLVPN_to_LAN`.
4.  **Incoming Interface:** `ssl.root` (دي الواجهة الافتراضية لـ SSL VPN).
5.  **Outgoing Interface:** `lan` (الواجهة اللي عليها الموارد اللي عايز توصلها).
6.  **Source:** `SSLVPN_Users` (مجموعة المستخدمين اللي عملتها).
7.  **Destination:** الشبكة الداخلية اللي عايز توصلها (مثلاً: `LAN_Subnet`).
8.  **Service:** `all` (أو الخدمات المحددة اللي عايز تسمح بيها).
9.  **Action:** `ACCEPT`.
10. **NAT:** تأكد إن `NAT` مفعل.

**مقارنة بـ Cisco AnyConnect:**

Cisco AnyConnect VPN Client بيوفر وظائف مشابهة لـ FortiClient في الـ SSL VPN. بيسمح بالوصول عن بُعد، وبيقدر يعمل Tunnel Mode و Web Mode. التكوين بيتم على Cisco ASA أو Firepower.

## 5.3 IPsec VPN (من موقع لموقع - Site-to-Site)

### 5.3.1 مفهوم IPsec VPN Site-to-Site

IPsec VPN Site-to-Site بيستخدم لربط شبكتين منفصلتين (زي المقر الرئيسي وفرع الشركة) عبر الإنترنت بشكل آمن. بيعمل نفق مشفر بين جهازي FortiGate (أو FortiGate وجهاز VPN تاني زي Cisco Router/ASA)، وبيخلي الشبكتين دول كأنهم شبكة واحدة.

### 5.3.2 تكوين IPsec VPN Site-to-Site

**الخطوة 1: تكوين Phase 1 (IKE Gateway) (GUI):**
1.  انتقل إلى **(VPN) -> (IPsec Tunnels)**.
2.  انقر على **(Create New) -> (IPsec Tunnel)**.
3.  **Name:** `Main_Office_to_Branch`.
4.  **Template Type:** `Site to Site`.
5.  **Remote Gateway:** `Static IP Address`.
6.  **IP Address:** عنوان IP الـ Public بتاع الفرع التاني.
7.  **Interface:** الواجهة اللي FortiGate هيستخدمها للاتصال (غالباً `wan1`).
8.  **Pre-shared Key:** كلمة سر مشتركة بين الجهازين (مهم جداً تكون قوية).
9.  **Phase 1 Proposal:**
    -   **Encryption:** `AES256`.
    -   **Authentication:** `SHA256`.
    -   **Diffie-Hellman Group:** `5`.
    -   **Keylife:** `86400` ثانية.

**عبر CLI:**
```
config vpn ipsec phase1-interface
    edit "Main_Office_to_Branch_P1"
        set interface "wan1"
        set ike-version 1
        set local-gw 1.1.1.1 # Public IP بتاع الجهاز ده
        set remote-gw 2.2.2.2 # Public IP بتاع الجهاز التاني
        set psksecret "MyStrongPskSecret!"
        set proposal aes256-sha256
        set dhgrp 5
        set keylife 86400
    next
end
```

**الخطوة 2: تكوين Phase 2 (IPsec Tunnel) (GUI):**
1.  بعد ما تخلص Phase 1، هتلاقي خيار **(Create Phase 2)**.
2.  **Name:** `Main_Office_to_Branch_P2`.
3.  **Local Address:** الشبكة الداخلية للمقر الرئيسي (مثلاً: `192.168.1.0/24`).
4.  **Remote Address:** الشبكة الداخلية للفرع (مثلاً: `192.168.2.0/24`).
5.  **Phase 2 Proposal:**
    -   **Encryption:** `AES256`.
    -   **Authentication:** `SHA256`.
    -   **Diffie-Hellman Group:** `5` (لازم تكون نفس اللي في Phase 1).
    -   **Keylife:** `3600` ثانية.

**عبر CLI:**
```
config vpn ipsec phase2-interface
    edit "Main_Office_to_Branch_P2"
        set phase1name "Main_Office_to_Branch_P1"
        set proposal aes256-sha256
        set dhgrp 5
        set keylife 3600
        set src-subnet 192.168.1.0 255.255.255.0
        set dst-subnet 192.168.2.0 255.255.255.0
    next
end
```

**الخطوة 3: إنشاء Static Route (GUI):**
1.  انتقل إلى **(Network) -> (Static Routes)**.
2.  انقر على **(Create New)**.
3.  **Destination:** الشبكة البعيدة (مثلاً: `192.168.2.0/24`).
4.  **Device:** اختر الـ IPsec Tunnel اللي عملته (مثلاً: `Main_Office_to_Branch`).

**عبر CLI:**
```
config router static
    edit 0
        set dst 192.168.2.0 255.255.255.0
        set device "Main_Office_to_Branch_P1"
    next
end
```

**الخطوة 4: إنشاء سياسة جدار حماية لـ IPsec VPN (GUI):**

هتعمل سياستين، واحدة تسمح بالترافيك من المقر الرئيسي للفرع، وواحدة العكس.

**السياسة الأولى (المقر الرئيسي للفرع):**
1.  **Incoming Interface:** `lan`.
2.  **Outgoing Interface:** `Main_Office_to_Branch` (اسم الـ IPsec Tunnel).
3.  **Source:** الشبكة الداخلية للمقر الرئيسي.
4.  **Destination:** الشبكة الداخلية للفرع.
5.  **Service:** `all`.
6.  **Action:** `ACCEPT`.
7.  **NAT:** `Disable` (لأن الـ IPsec بيحافظ على الـ IPs الأصلية).

**السياسة الثانية (الفرع للمقر الرئيسي):**
1.  **Incoming Interface:** `Main_Office_to_Branch`.
2.  **Outgoing Interface:** `lan`.
3.  **Source:** الشبكة الداخلية للفرع.
4.  **Destination:** الشبكة الداخلية للمقر الرئيسي.
5.  **Service:** `all`.
6.  **Action:** `ACCEPT`.
7.  **NAT:** `Disable`.

**مقارنة بـ Cisco IPsec VPN:**

تكوين IPsec VPN في Cisco (على Routers أو ASA) بيشمل نفس المفاهيم: Phase 1 (ISAKMP/IKE) و Phase 2 (IPsec). بتحدد الـ Encryption, Hashing, DH Group, Keylife. وبتستخدم Crypto Maps أو VTI لربط الـ VPN بالواجهات. FortiGate بيقدم واجهة أبسط شوية، لكن المبادئ الأساسية هي هي.

## 5.4 استكشاف أخطاء VPN وإصلاحها (VPN Troubleshooting)

مشاكل الـ VPN ممكن تكون محبطة، لكن FortiGate بيوفر أدوات قوية للتشخيص.

### 5.4.1 مشاكل SSL VPN الشائعة

-   **عدم القدرة على الاتصال:**
    -   تأكد من أن FortiGate يستمع على البورت الصحيح (مثلاً 10443) وأن البورت ده مفتوح على جدار الحماية الخارجي (لو فيه).
    -   تأكد من أن المستخدم موجود في مجموعة SSL VPN الصحيحة.
    -   تأكد من أن FortiClient مثبت بشكل صحيح.
-   **عدم القدرة على الوصول للموارد بعد الاتصال:**
    -   تأكد من أن الـ IP Pool بتاع الـ SSL VPN مش متعارض مع أي شبكة تانية.
    -   تأكد من وجود Static Route للشبكة الداخلية عبر الـ SSL VPN Interface (`ssl.root`).
    -   تأكد من وجود Firewall Policy تسمح بالترافيك من `ssl.root` للشبكة الداخلية.

### 5.4.2 مشاكل IPsec VPN الشائعة

-   **Phase 1 Down:**
    -   **Pre-shared Key:** تأكد إن الـ Pre-shared Key هو هو على الجهازين.
    -   **IP Addresses:** تأكد إن الـ Public IPs صحيحة على الجهازين.
    -   **Phase 1 Proposals:** تأكد إن الـ Encryption, Authentication, DH Group, Keylife متطابقين على الجهازين.
    -   **Firewall Policy:** تأكد إن فيه سياسة تسمح بمرور ترافيك IKE (UDP 500, UDP 4500) بين الجهازين.
-   **Phase 2 Down:**
    -   **Phase 2 Proposals:** تأكد إن الـ Encryption, Authentication, DH Group, Keylife متطابقين.
    -   **Local/Remote Subnets:** تأكد إن الشبكات المحلية والبعيدة معرفة بشكل صحيح على الجهازين.
    -   **Static Routes:** تأكد من وجود Static Route للشبكة البعيدة عبر الـ IPsec Tunnel.
    -   **Firewall Policy:** تأكد من وجود سياسات تسمح بالترافيك بين الشبكتين عبر الـ IPsec Tunnel.

### 5.4.3 أدوات التشخيص (CLI)

-   **`diagnose vpn tunnel list`:** لعرض حالة أنفاق الـ VPN.
-   **`diagnose vpn ike log level -1`:** لتفعيل تسجيل تفاصيل IKE (Phase 1).
-   **`diagnose debug application ike -1`:** لتفعيل تصحيح أخطاء IKE.
-   **`diagnose debug application sslvpn -1`:** لتفعيل تصحيح أخطاء SSL VPN.
-   **`diagnose sniffer packet`:** لالتقاط الحزم على الواجهات لمعرفة إذا كانت الحزم بتوصل أو بتخرج.
-   **`diagnose debug flow`:** لتتبع مسار الحزم داخل FortiGate.

**مقارنة بـ Cisco VPN Troubleshooting:**

Cisco عندها أوامر `show crypto isakmp sa` و `show crypto ipsec sa` لمراقبة حالة الـ VPNs، وأوامر `debug crypto isakmp` و `debug crypto ipsec` لتتبع مشاكل الـ VPN. المفهوم هو نفسه: استخدام أدوات التشخيص المتاحة لتحديد المشكلة في الـ Phase 1 أو Phase 2.

## الخلاصة

في الفصل ده، غطينا موضوع الـ VPNs المهم جداً على FortiGate. عرفنا الفرق بين SSL VPN و IPsec VPN، وإمتى نستخدم كل واحد. اتعلمنا إزاي نكونهم خطوة بخطوة، وإزاي نربطهم بالمستخدمين وسياسات جدار الحماية.

الأهم من ده كله، إننا عرفنا إزاي نستكشف الأخطاء ونحل المشاكل الشائعة في الـ VPNs باستخدام أدوات التشخيص القوية اللي FortiGate بيوفرها. دلوقتي أنت بقيت جاهز إنك توفر اتصال آمن وموثوق بيه لشبكتك، سواء للموظفين أو لربط الفروع.

يلا بينا على الفصل اللي جاي عشان ندخل في عالم الـ Security Profiles والميزات الأمنية المتقدمة اللي بتخلي FortiGate جدار حماية لا يستهان به!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل السادس: ملفات تعريف الأمان (Security Profiles - UTM Features)

## نظرة عامة على الفصل

يا جماعة، بعد ما فهمنا إزاي FortiGate بيتحكم في حركة المرور وبيعمل مصادقة للمستخدمين وبيعمل VPNs، دلوقتي جه وقت نتكلم عن الأسلحة الفتاكة اللي FortiGate بيستخدمها عشان يحارب التهديدات الأمنية. الفصل ده هيركز على ملفات تعريف الأمان (Security Profiles)، أو اللي بنسميها ميزات الـ UTM (Unified Threat Management).

دي الميزات اللي بتخلي FortiGate مش مجرد جدار حماية عادي، دي اللي بتخليه جدار حماية من الجيل التالي (NGFW). هنتكلم بالتفصيل عن كل ميزة: مكافحة الفيروسات (Antivirus)، نظام منع التسلل (IPS)، تصفية الويب (Web Filtering)، التحكم في التطبيقات (Application Control)، ومنع تسرب البيانات (DLP). هنشرح كل واحدة بتشتغل إزاي، وإزاي تكونها، وإزاي تربطها بسياسات جدار الحماية عشان توفر حماية متكاملة.

الفصل ده هو اللي هيخليك تستفيد من قوة FortiGate الحقيقية، وتأمن شبكتك من كل أنواع التهديدات. يلا بينا نخش في التفاصيل!

## 6.1 مقدمة إلى Security Profiles

### 6.1.1 ما هي Security Profiles؟

Security Profiles هي مجموعة من الميزات الأمنية المتقدمة اللي FortiGate بيطبقها على حركة المرور اللي بتعدي من خلاله. كل ميزة ليها ملف تعريف (Profile) خاص بيها، بتقدر تكونه وتخصصه حسب احتياجاتك. بعد كده، بتربط الـ Profiles دي بسياسات جدار الحماية (Firewall Policies).

**المبدأ الأساسي:**

لما حركة المرور تطابق سياسة جدار حماية معينة، FortiGate بيبص على الـ Security Profiles اللي مربوطة بالسياسة دي، وبيطبقها على حركة المرور. ده بيوفر حماية متعددة الطبقات (Layered Security)، يعني لو تهديد عدى من طبقة، ممكن يتقفش في الطبقة اللي بعدها.

### 6.1.2 أنواع Security Profiles

-   **Antivirus:** بيكتشف ويمنع الفيروسات والبرامج الضارة.
-   **Intrusion Prevention System (IPS):** بيكتشف ويمنع محاولات الاختراق والهجمات.
-   **Web Filter:** بيتحكم في تصفح الويب ويمنع الوصول للمواقع الضارة أو غير المرغوب فيها.
-   **Application Control:** بيتعرف على التطبيقات (حتى لو بتستخدم بورتات غير قياسية) ويتحكم فيها.
-   **Data Leakage Prevention (DLP):** بيمنع تسرب البيانات الحساسة خارج الشبكة.
-   **SSL/SSH Inspection:** بيفحص حركة المرور المشفرة (HTTPS, SSH) عشان يكتشف التهديدات المخفية جواها.

## 6.2 مكافحة الفيروسات (Antivirus)

### 6.2.1 مفهوم Antivirus

ميزة الـ Antivirus في FortiGate بتفحص الملفات اللي بتعدي من خلاله (زي الملفات اللي بتتحمل من الإنترنت أو اللي بتتبعت في الإيميل) عشان تكتشف الفيروسات والبرامج الضارة. بتعتمد على قاعدة بيانات من توقيعات الفيروسات (Virus Signatures) اللي بيتم تحديثها باستمرار من FortiGuard Labs.

### 6.2.2 تكوين Antivirus Profile

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (Antivirus)**.
2.  انقر على **(Create New)** أو عدّل الـ `default` Profile.
3.  **Scan Mode:**
    -   **Quick:** بيفحص الملفات بسرعة باستخدام توقيعات الفيروسات فقط.
    -   **Full:** بيفحص الملفات بشكل أعمق، وممكن يرسل الملفات المشبوهة لـ FortiSandbox لتحليلها.
4.  **Protocols:** حدد البروتوكولات اللي عايز تفحصها (HTTP, FTP, SMTP, POP3, IMAP).
5.  **Action:** حدد الإجراء اللي هيتاخد لو لقى فيروس (Block, Monitor).

**عبر CLI:**
```
config antivirus profile
    edit "my_av_profile"
        set scan-mode full
        config http
            set options scan
        end
        config ftp
            set options scan
        end
    next
end
```

### 6.2.3 ربط Antivirus Profile بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `Antivirus` واختر الـ Profile اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set av-profile "my_av_profile"
    next
end
```

**مقارنة بـ Cisco AMP:**

Cisco Advanced Malware Protection (AMP) هو حل Cisco لمكافحة البرامج الضارة. بيشتغل بشكل مشابه لـ FortiGate Antivirus، لكنه بيوفر تحليل سلوكي متقدم وتتبع للملفات عبر الشبكة. FortiGate بيوفر نفس القدرات دي من خلال التكامل مع FortiSandbox.

## 6.3 نظام منع التسلل (Intrusion Prevention System - IPS)

### 6.3.1 مفهوم IPS

الـ IPS بيحمي الشبكة من الهجمات اللي بتستغل الثغرات في أنظمة التشغيل والتطبيقات. بيشتغل عن طريق مقارنة حركة المرور بقاعدة بيانات من توقيعات الهجمات المعروفة (IPS Signatures). لو لقى تطابق، بيمنع الهجوم فوراً.

### 6.3.2 تكوين IPS Sensor

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (Intrusion Prevention)**.
2.  انقر على **(Create New)** أو عدّل الـ `default` Sensor.
3.  **IPS Signatures:** ممكن تضيف توقيعات محددة أو تستخدم الفلاتر (Filters) عشان تفعل مجموعة من التوقيعات بناءً على الخطورة أو نوع الهجوم.
4.  **Action:** حدد الإجراء اللي هيتاخد لو لقى هجوم (Block, Monitor, Reset).

**عبر CLI:**
```
config ips sensor
    edit "my_ips_sensor"
        config entries
            edit 1
                set rule <signature_id>
                set action block
            next
        end
    next
end
```

### 6.3.3 ربط IPS Sensor بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `IPS` واختر الـ Sensor اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set ips-sensor "my_ips_sensor"
    next
end
```

**مقارنة بـ Cisco Firepower IPS:**

Cisco Firepower NGFW بيوفر IPS قوي جداً، بيعتمد على قاعدة بيانات ضخمة من التوقيعات من Talos (فريق أبحاث التهديدات بتاع Cisco). المفهوم هو نفسه: مقارنة الترافيك بالتوقيعات ومنع الهجمات. FortiGate بيوفر نفس الوظيفة من خلال FortiGuard Labs.

## 6.4 تصفية الويب (Web Filtering)

### 6.4.1 مفهوم Web Filtering

Web Filtering بيسمحلك تتحكم في المواقع اللي المستخدمين بيقدروا يوصلولها. بيعتمد على قاعدة بيانات ضخمة بتصنف المواقع لفئات (Categories) زي (Social Media, News, Gambling, Malicious Sites). ممكن تسمح أو تمنع فئات معينة، أو تعمل تحذير للمستخدم قبل ما يدخل موقع معين.

### 6.4.2 تكوين Web Filter Profile

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (Web Filter)**.
2.  انقر على **(Create New)** أو عدّل الـ `default` Profile.
3.  **FortiGuard Category Based Filter:** هنا هتلاقي كل الفئات، ممكن تختار `Allow`, `Block`, `Monitor`, `Warning` لكل فئة.
4.  **Static URL Filter:** ممكن تضيف مواقع معينة وتسمح بيها أو تمنعها بغض النظر عن الفئة بتاعتها.

**عبر CLI:**
```
config webfilter profile
    edit "my_webfilter_profile"
        config ftgd-wf
            config filters
                edit 1
                    set category 26 # مثال: Social Networking
                    set action block
                next
            end
        end
    next
end
```

### 6.4.3 ربط Web Filter Profile بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `Web Filter` واختر الـ Profile اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set webfilter-profile "my_webfilter_profile"
    next
end
```

**مقارنة بـ Cisco Umbrella:**

Cisco Umbrella هو حل سحابي لتصفية الويب وحماية DNS. بيوفر وظائف مشابهة لـ FortiGate Web Filter، لكنه بيشتغل على مستوى الـ DNS، وده بيخليه يقدر يحمي الأجهزة حتى لو كانت بره الشبكة. FortiGate بيوفر نفس الحماية دي من خلال FortiClient.

## 6.5 التحكم في التطبيقات (Application Control)

### 6.5.1 مفهوم Application Control

Application Control بيتعرف على التطبيقات اللي بتعدي من خلال FortiGate، حتى لو كانت بتستخدم بورتات غير قياسية أو بتحاول تتخفى. بيعتمد على قاعدة بيانات من توقيعات التطبيقات (Application Signatures). بعد ما يتعرف على التطبيق، ممكن تسمح بيه، أو تمنعه، أو تتحكم في استخدامه (مثلاً: تسمح بالفيسبوك بس تمنع الشات بتاعه).

### 6.5.2 تكوين Application Control Profile

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (Application Control)**.
2.  انقر على **(Create New)** أو عدّل الـ `default` Profile.
3.  **Categories:** ممكن تمنع فئات كاملة من التطبيقات (زي P2P, Proxy, Games).
4.  **Application Overrides:** ممكن تختار تطبيقات معينة وتسمح بيها أو تمنعها.

**عبر CLI:**
```
config application list
    edit "my_app_control_profile"
        config entries
            edit 1
                set application 15833 # مثال: Facebook
                set action block
            next
        end
    next
end
```

### 6.5.3 ربط Application Control Profile بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `Application Control` واختر الـ Profile اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set application-list "my_app_control_profile"
    next
end
```

**مقارنة بـ Cisco Firepower Application Control:**

Cisco Firepower NGFW بيوفر Application Control قوي جداً، بيقدر يتعرف على آلاف التطبيقات ويتحكم فيها. المفهوم هو نفسه: التعرف على التطبيقات بناءً على التوقيعات وتطبيق سياسات عليها.

## 6.6 منع تسرب البيانات (Data Leakage Prevention - DLP)

### 6.6.1 مفهوم DLP

DLP بيحمي البيانات الحساسة (زي أرقام بطاقات الائتمان، أرقام الهوية، معلومات شخصية) من التسرب خارج الشبكة. بيشتغل عن طريق فحص حركة المرور بحثاً عن أنماط معينة (Patterns) بتدل على وجود بيانات حساسة.

### 6.6.2 تكوين DLP Sensor

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (Data Leak Prevention)**.
2.  انقر على **(Create New)** أو عدّل الـ `default` Sensor.
3.  **Rules:** ممكن تضيف قواعد (Rules) عشان تبحث عن أنماط معينة (زي `Credit-Card`, `SSN`) أو تعمل أنماط مخصصة.
4.  **Action:** حدد الإجراء اللي هيتاخد لو لقى بيانات حساسة (Block, Log Only).

**عبر CLI:**
```
config dlp sensor
    edit "my_dlp_sensor"
        config entries
            edit 1
                set filter-by file-type
                set file-type 1 # مثال: PDF
                set action block
            next
        end
    next
end
```

### 6.6.3 ربط DLP Sensor بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `DLP` واختر الـ Sensor اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set dlp-sensor "my_dlp_sensor"
    next
end
```

**مقارنة بـ Cisco DLP:**

Cisco بتوفر حلول DLP من خلال منتجات مختلفة زي Cisco Email Security Appliance (ESA) و Web Security Appliance (WSA). المفهوم هو نفسه: فحص المحتوى بحثاً عن بيانات حساسة ومنع تسربها.

## 6.7 أوضاع الفحص (Inspection Modes)

FortiGate بيستخدم وضعين رئيسيين لفحص حركة المرور:

-   **Flow-based Inspection:**
    -   بيفحص حركة المرور أثناء مرورها (on-the-fly) من غير ما يخزن الملفات كلها.
    -   أسرع في الأداء، لكنه أقل دقة في اكتشاف بعض التهديدات المعقدة.
    -   مناسب لمعظم أنواع حركة المرور.

-   **Proxy-based Inspection:**
    -   بيشتغل كـ Proxy، يعني بيستقبل الملف كله، وبيفحصه، وبعدين بيبعته للوجهة.
    -   أبطأ في الأداء، لكنه بيوفر فحص أعمق وأكثر دقة.
    -   ضروري لبعض الميزات زي DLP و SSL Inspection.

**تحديد وضع الفحص في سياسة جدار الحماية (GUI):**
1.  في سياسة جدار الحماية، هتلاقي خيار **(Inspection Mode)**.
2.  اختر `Flow-based` أو `Proxy-based`.

**مقارنة بـ Cisco:**

Cisco Firepower NGFW بيستخدم تقنيات فحص مشابهة، بيقدر يفحص الترافيك أثناء مروره، وفي نفس الوقت بيقدر يعمل تحليل أعمق للملفات باستخدام AMP.

## الخلاصة

في الفصل ده، اتعمقنا في قلب قوة FortiGate الأمنية: الـ Security Profiles. عرفنا إزاي كل ميزة (Antivirus, IPS, Web Filter, Application Control, DLP) بتشتغل، وإزاي تكونها، وإزاي تربطها بسياسات جدار الحماية.

دلوقتي أنت فهمت إزاي تبني دفاع متعدد الطبقات، وإزاي تستفيد من كل إمكانيات FortiGate عشان تحمي شبكتك من كل أنواع التهديدات. لو قدرت تطبق اللي اتعلمته في الفصل ده، فأنت بقيت قادر على بناء حل أمني قوي ومتكامل لأي شبكة.

يلا بينا على الفصل اللي جاي عشان نتكلم عن إدارة النظام والتوافرية العالية (HA)، عشان نضمن إن FortiGate بتاعنا شغال دايماً ومستقر.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل السابع: إدارة النظام والتوافرية العالية (System Management and High Availability)

## نظرة عامة على الفصل

يا جماعة، بعد ما اتعلمنا إزاي FortiGate بيحمي الشبكة وبيتحكم في كل حاجة، دلوقتي جه وقت نتكلم عن إزاي نحافظ على الجهاز ده شغال زي الفل، وإزاي نضمن إنه ميفصلش أبداً! الفصل ده هيركز على إدارة النظام (System Management) والتوافرية العالية (High Availability - HA).

هنتكلم عن أهمية تسجيل السجلات (Logging) ومراقبة الأداء (Monitoring) عشان نعرف إيه اللي بيحصل في الشبكة والجهاز. وهنشوف إزاي FortiGate بيقدر يعمل تقارير (Reporting) وتنبيهات (Alerting) عشان نكون دايماً في الصورة. الأهم من ده كله، هنتعمق في مفهوم الـ HA، اللي بيخلي عندك جهازين FortiGate شغالين مع بعض، بحيث لو واحد وقع، التاني يشتغل مكانه على طول من غير ما تحس بأي حاجة. ده بيضمن إن شبكتك تفضل شغالة 24/7.

الفصل ده هيخليك مطمن على شبكتك، وعارف إنها محمية ومستقرة. يلا بينا نخش في التفاصيل!

## 7.1 تسجيل السجلات والمراقبة (Logging and Monitoring)

### 7.1.1 أهمية السجلات (Logs)

السجلات هي عينك على الشبكة. بتسجل كل حاجة بتحصل على FortiGate: مين دخل، مين خرج، إيه المواقع اللي اتفتحت، إيه الهجمات اللي اتصدت، وإيه المشاكل اللي حصلت. من غير السجلات، أنت أعمى ومش هتعرف إيه اللي بيحصل في شبكتك.

**أنواع السجلات الرئيسية:**
-   **Traffic Logs:** بتسجل كل حركة المرور اللي بتعدي من FortiGate (مين بيكلم مين، على بورت إيه، وإيه السياسة اللي سمحت بكده).
-   **Event Logs:** بتسجل الأحداث اللي بتحصل على الجهاز نفسه (زي تسجيل الدخول، تغيير التكوين، مشاكل النظام).
-   **Security Logs:** بتسجل الأحداث الأمنية (زي اكتشاف فيروس، هجوم IPS، حظر موقع).

### 7.1.2 عرض السجلات على FortiGate

**عبر GUI:**
1.  انتقل إلى **(Log & Report) -> (Log Events)**.
2.  هتلاقي أنواع مختلفة من السجلات (Traffic, System, Security). تقدر تختار النوع اللي عايز تشوفه.
3.  ممكن تعمل Filter عشان تدور على حاجة معينة (مثلاً: IP معين، أو تاريخ معين).

**عبر CLI:**
```
# لعرض سجلات الترافيك
execute log display traffic

# لعرض سجلات النظام
execute log display event

# لعرض سجلات الأمن
execute log display utm
```

### 7.1.3 إعدادات تسجيل السجلات (Log Settings)

FortiGate ممكن يسجل السجلات محلياً على الجهاز، أو يبعتها لخادم خارجي زي FortiAnalyzer أو Syslog server.

**عبر GUI:**
1.  انتقل إلى **(Log & Report) -> (Log Settings)**.
2.  **Local Log:** فعلها لو عايز تسجل السجلات على الجهاز نفسه.
3.  **FortiAnalyzer / FortiManager:** فعلها لو عندك FortiAnalyzer أو FortiManager وعايز تبعتله السجلات.
4.  **Syslog:** فعلها لو عايز تبعت السجلات لـ Syslog server خارجي.

**عبر CLI:**
```
config log memory setting
    set status enable
end

config log fortianalyzer setting
    set status enable
    set server "10.0.0.200" # IP FortiAnalyzer
    set upload-option realtime
end

config log syslogd setting
    set status enable
    set server "10.0.0.201" # IP Syslog Server
    set port 514
end
```

**مقارنة بـ Cisco Logging:**

Cisco أيضاً بتدعم تسجيل السجلات محلياً (Flash) أو إرسالها لـ Syslog server خارجي. الأوامر زي `logging host <ip>` و `logging trap <level>`. المفهوم واحد: جمع السجلات لتحليلها ومراقبة الشبكة.

## 7.2 التقارير والتنبيهات (Reporting and Alerting)

### 7.2.1 التقارير (Reporting)

التقارير بتساعدك تحول السجلات الخام لمعلومات مفيدة ومفهومة. FortiGate بيقدر يعمل تقارير عن:
-   أكثر المستخدمين استخداماً للإنترنت.
-   أكثر التطبيقات استخداماً.
-   أكثر التهديدات شيوعاً.
-   حالة الجهاز وأداءه.

**عبر GUI:**
1.  انتقل إلى **(Log & Report) -> (Report Settings)**.
2.  ممكن تعمل تقارير مخصصة أو تستخدم القوالب الجاهزة.
3.  ممكن تحدد مواعيد لإنشاء التقارير وإرسالها بالإيميل.

### 7.2.2 التنبيهات (Alerting)

التنبيهات بتخليك تعرف أول بأول لو حصل أي حدث مهم أو مشكلة. ممكن FortiGate يبعتلك إيميل، أو رسالة SMS، أو SNMP Trap لو حصل حاجة معينة (زي ارتفاع استخدام الـ CPU، أو اكتشاف فيروس خطير).

**عبر GUI:**
1.  انتقل إلى **(System) -> (Alert E-mail)** أو **(SNMP)**.
2.  حدد الشروط اللي عايز FortiGate يبعتلك عليها تنبيه.

**مقارنة بـ Cisco:**

Cisco بتوفر أيضاً إمكانيات تقارير وتنبيهات من خلال منتجات زي Cisco Prime Infrastructure أو Cisco DNA Center، أو عن طريق إرسال SNMP Traps لـ NMS (Network Management System).

## 7.3 مفاهيم التوافرية العالية (High Availability - HA)

### 7.3.1 لماذا نحتاج إلى HA؟

الـ HA هي الحل اللي بيضمن إن شبكتك تفضل شغالة حتى لو حصل عطل في جهاز FortiGate. تخيل إن FortiGate هو البوابة الوحيدة للإنترنت في شركتك، لو وقع، الشركة كلها هتقف. الـ HA بيحل المشكلة دي عن طريق استخدام جهازين FortiGate بيشتغلوا مع بعض كجهاز واحد.

**الهدف من HA:**
-   **الاستمرارية (Business Continuity):** ضمان إن الخدمات الحيوية تفضل شغالة.
-   **تقليل وقت التوقف (Minimize Downtime):** لو جهاز وقع، التاني بيشتغل مكانه في ثواني.
-   **تحسين الأداء (Performance Improvement):** في بعض أنواع الـ HA (Active-Active)، ممكن الجهازين يشتغلوا مع بعض عشان يزودوا الأداء.

### 7.3.2 أنواع HA في FortiGate

FortiGate بيدعم نوعين رئيسيين من الـ HA:

-   **Active-Passive (Recommended for most deployments):**
    -   جهاز واحد بيكون `Active` (شغال وبيعدي الترافيك).
    -   الجهاز التاني بيكون `Passive` (مستعد، ومستني أي لحظة عشان يشتغل مكان الـ Active).
    -   كل الترافيك بيعدي من الـ Active، ولو وقع، الـ Passive بيتحول لـ Active في ثواني.
    -   سهل التكوين والإدارة.

-   **Active-Active:**
    -   الجهازين بيكونوا `Active` وبيعدوا الترافيك في نفس الوقت.
    -   بيوفر أداء أعلى (Load Balancing).
    -   أكثر تعقيداً في التكوين والإدارة.

**مكونات HA:**
-   **Heartbeat Links:** كابلات خاصة بين الجهازين عشان يكلموا بعض ويراقبوا حالة بعض.
-   **Session Synchronization:** الجهاز الـ Active بيبعت معلومات الـ Sessions للـ Passive عشان لو حصل Failover، الـ Sessions تفضل شغالة من غير ما المستخدمين يحسوا بحاجة.
-   **Failover Detection:** الجهازين بيراقبوا بعض، ولو واحد وقع (مبقتش بيبعت Heartbeat)، التاني بيعرف وبيتحول لـ Active.

**مقارنة بـ Cisco HA:**

Cisco عندها حلول HA مشابهة:
-   **HSRP/VRRP/GLBP:** لـ Routers و Layer 3 Switches (مكافئ لـ Active-Passive و Active-Active).
-   **Cisco ASA HA:** بيدعم Active-Passive و Active-Active، وبيستخدم نفس مفاهيم Heartbeat و Session Synchronization.

## 7.4 تكوين HA (Active-Passive)

### 7.4.1 المتطلبات الأساسية (Prerequisites)

-   جهازين FortiGate من نفس الموديل ونفس إصدار الـ Firmware.
-   نفس عدد الواجهات ونفس نوعها.
-   كابلات Heartbeat بين الجهازين (يفضل استخدام منافذ مخصصة للـ HA).
-   توصيل الكابلات الفيزيائية للواجهات (LAN, WAN) من الجهازين لنفس السويتشات.

### 7.4.2 خطوات التكوين (GUI)

**الخطوة 1: الإعدادات الأولية على الجهازين:**
-   تأكد إن الجهازين عليهم نفس إصدار الـ Firmware.
-   اعمل Reset Factory Defaults للجهازين عشان تبدأ من الصفر.
-   وصل الجهازين ببعض بكابلات الـ Heartbeat (يفضل استخدام منفذين منفصلين).

**الخطوة 2: تكوين الجهاز الأول (Primary/Master):**
1.  انتقل إلى **(System) -> (HA)**.
2.  **HA Mode:** `Active-Passive`.
3.  **Device Priority:** `200` (ده هيكون الـ Master، فندي له أولوية أعلى).
4.  **Group Name:** `My_FortiGate_HA` (اسم مجموعة الـ HA).
5.  **Password:** كلمة سر للـ HA (مهمة جداً).
6.  **Heartbeat Interfaces:** اختار الواجهات اللي هتستخدمها للـ Heartbeat (مثلاً: `port5`, `port6`).
7.  **Session Pickup:** `Enable` (عشان الـ Sessions متتقطعش وقت الـ Failover).
8.  **Monitor Interfaces:** اختار الواجهات اللي FortiGate هيراقبها عشان يكتشف لو حصل فيها مشكلة (مثلاً: `wan1`, `lan`). لو أي واجهة من دول وقعت، الجهاز هيعمل Failover.
9.  انقر على **(OK)**.

**عبر CLI (على الجهاز الأول):**
```
config system ha
    set mode a-p
    set group-name "My_FortiGate_HA"
    set password "MyHAPassword!"
    set priority 200
    set hbdev "port5" 50 "port6" 100 # الواجهات والأولويات
    set session-pickup enable
    set monitor "wan1" "lan"
end
```

**الخطوة 3: تكوين الجهاز الثاني (Secondary/Slave):**
1.  نفس الخطوات اللي فاتت، لكن:
    -   **Device Priority:** `100` (أقل من الـ Master).
    -   **Group Name:** `My_FortiGate_HA` (نفس الاسم).
    -   **Password:** نفس كلمة السر.
    -   **Heartbeat Interfaces:** نفس الواجهات.
    -   **Session Pickup:** `Enable`.
    -   **Monitor Interfaces:** نفس الواجهات.
2.  انقر على **(OK)**. الجهاز ده هيعمل Reboot وهينضم لمجموعة الـ HA.

### 7.4.3 التحقق من HA (Verification)

**عبر GUI:**
1.  انتقل إلى **(System) -> (HA)**.
2.  هتشوف حالة الجهازين (Master, Slave) وحالة الـ Heartbeat والـ Session Synchronization.

**عبر CLI:**
```
get system ha status
```

**مثال على مخرجات `get system ha status`:**
```
HA Status: Master
HA Group Member: 1
HA Group ID: 0
HA Group Name: My_FortiGate_HA
Mode: Active-Passive
Master: FG100D-1 (200)
Slave: FG100D-2 (100)
Heartbeat: OK
Session Sync: OK
```

### 7.4.4 عملية الـ Failover

لو الجهاز الـ Active وقع (سواء بسبب عطل في الهاردوير، أو مشكلة في السوفتوير، أو انقطاع في أحد الـ Monitor Interfaces)، الجهاز الـ Passive هيكتشف ده وهيتحول لـ Active. العملية دي بتاخد ثواني قليلة، ومع الـ Session Synchronization، المستخدمين مش هيحسوا بأي انقطاع في معظم الحالات.

**مقارنة بـ Cisco ASA Failover:**

Cisco ASA Failover بيشتغل بنفس المفهوم. جهاز Active وجهاز Standby. بيستخدموا Heartbeat Links لمراقبة بعض، وبيعملوا Session Synchronization. لو الـ Active وقع، الـ Standby بيتحول لـ Active. الأوامر بتختلف، لكن المبادئ هي هي.

## الخلاصة

في الفصل ده، اتعلمنا إزاي ندير نظام FortiGate بشكل فعال، من خلال تسجيل السجلات والمراقبة، وإنشاء التقارير والتنبيهات. الأهم من ده كله، إننا فهمنا قوة التوافرية العالية (HA) وإزاي بتضمن استمرارية عمل شبكتك حتى في حالة الأعطال.

دلوقتي أنت بقيت قادر على بناء شبكة مستقرة ومحمية، وتقدر تتعامل مع أي مشكلة ممكن تحصل بثقة. الفصل ده بيقفل جزء مهم جداً من رحلتنا في FortiGate، وبيخليك جاهز إنك تدخل في مواضيع متقدمة أكتر. يلا بينا على الفصل اللي جاي!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الثامن: التوجيه المتقدم والشبكات اللاسلكية (Advanced Routing and Wireless Networking)

## نظرة عامة على الفصل

يا جماعة، بعد ما خلصنا كلام عن إدارة FortiGate والتوافرية العالية، دلوقتي هنخش في مواضيع ممكن تكون متقدمة شوية بس مهمة جداً: التوجيه المتقدم (Advanced Routing) والشبكات اللاسلكية (Wireless Networking).

في الفصل ده، هنتعمق أكتر في بروتوكولات التوجيه الديناميكي زي OSPF و BGP، وهنشوف إزاي FortiGate بيتعامل معاها عشان يحدد أفضل مسار لحركة المرور في الشبكات الكبيرة والمعقدة. كمان، هنتكلم عن الـ Policy-Based Routing (PBR) اللي بتسمحلك تتحكم في مسار الترافيك بناءً على شروط معينة، مش بس بناءً على الـ Destination IP.

الجزء التاني من الفصل هيكون عن الشبكات اللاسلكية. FortiGate مش بس جدار حماية، ده كمان ممكن يشتغل كـ Wireless Controller عشان يدير نقاط الوصول اللاسلكية (Access Points) ويوفر شبكة Wi-Fi آمنة وموثوقة. هنشوف إزاي تكون شبكة Wi-Fi، وإزاي تأمنها، وإزاي تدير الـ Access Points.

الفصل ده هيفتحلك آفاق جديدة في تصميم وإدارة الشبكات باستخدام FortiGate. يلا بينا نخش في التفاصيل!

## 8.1 مفاهيم التوجيه المتقدم (Advanced Routing Concepts)

### 8.1.1 مراجعة سريعة للتوجيه (Routing Review)

فاكرين لما اتكلمنا عن الـ Static Routes في الفصول اللي فاتت؟ الـ Static Routes دي زي ما تكون بتدي FortiGate خريطة ثابتة وتقوله: 


لو عايز تروح للمكان الفلاني، امشي في الطريق ده. دي كويسة للشبكات الصغيرة أو لما تكون المسارات ثابتة ومبتتغيرش كتير.

لكن في الشبكات الكبيرة والمعقدة، اللي فيها فروع كتير، أو اللي متصلة بشبكات تانية (زي الإنترنت)، الـ Static Routes مش عملية. هنا بيجي دور بروتوكولات التوجيه الديناميكي (Dynamic Routing Protocols).

### 8.1.2 بروتوكولات التوجيه الديناميكي (Dynamic Routing Protocols)

بروتوكولات التوجيه الديناميكي بتخلي الـ Routers (أو FortiGate في حالتنا) يتبادلوا معلومات عن الشبكات اللي يعرفوها مع بعض. كده كل Router بيقدر يبني خريطة كاملة للشبكة، ولما يحصل أي تغيير (زي إن لينك يقع أو شبكة جديدة تتضاف)، كل الـ Routers بتعرف التغيير ده تلقائياً وبتعدل مساراتها.

**أمثلة على بروتوكولات التوجيه الديناميكي:**

-   **OSPF (Open Shortest Path First):**
    -   ده بروتوكول `Link-State`، يعني كل Router بيبعت معلومات عن اللينكات اللي متصل بيها وحالتها للـ Routers التانية في نفس الـ Area.
    -   بيستخدم خوارزمية Dijkstra عشان يحسب أقصر مسار لكل شبكة.
    -   مناسب للشبكات الكبيرة اللي ليها هيكل هرمي (Hierarchical) ومتقسمة لـ Areas.
    -   FortiGate بيدعم OSPF بشكل كامل، وممكن يشتغل كـ OSPF Router في الشبكة.

-   **BGP (Border Gateway Protocol):**
    -   ده بروتوكول `Path-Vector`، يعني كل Router بيبعت معلومات عن المسارات اللي يعرفها للـ Routers التانية، ومع كل مسار بيبعت معلومات عن الـ Autonomous Systems (AS) اللي الترافيك هيعدي عليها.
    -   ده البروتوكول اللي بيستخدم على الإنترنت عشان يربط بين الـ Autonomous Systems المختلفة (مزودي الخدمة الكبار، الشركات الكبيرة جداً).
    -   معقد أكتر من OSPF، ومناسب للشبكات اللي بتحتاج تتحكم في الترافيك اللي داخل وخارج من الـ AS بتاعها، أو اللي ليها اتصالات متعددة بالإنترنت.
    -   FortiGate بيدعم BGP، وممكن يشتغل كـ BGP Router.

**مقارنة بـ Cisco:**

Cisco هي الرائدة في بروتوكولات التوجيه، وبتدعم OSPF و BGP بشكل كامل على كل أجهزتها (Routers, Switches, Firewalls). المبادئ الأساسية لعمل البروتوكولات دي هي هي على FortiGate أو Cisco، لكن أوامر التكوين بتختلف.

### 8.1.3 التوجيه القائم على السياسات (Policy-Based Routing - PBR)

الـ PBR بتسمحلك تتحكم في مسار الترافيك بناءً على شروط معينة، مش بس بناءً على الـ Destination IP. يعني ممكن تقول للـ FortiGate: "لو الترافيك ده جاي من الـ IP الفلاني، أو رايح للـ IP الفلاني، أو بيستخدم البورت الفلاني، طلعه من الواجهة دي، حتى لو الـ Routing Table بيقول حاجة تانية".

**متى نستخدم PBR؟**
-   **توجيه ترافيك معين من واجهة محددة:** مثلاً، ترافيك الـ VoIP يطلع من لينك معين، وترافيك الإنترنت العادي يطلع من لينك تاني.
-   **Load Balancing:** توزيع الترافيك على أكتر من لينك.
-   **Failover:** لو لينك وقع، الترافيك يتحول تلقائياً للينك التاني.
-   **تجاوز الـ VPN:** لو عايز ترافيك معين ميمرش من الـ VPN Tunnel.

**تكوين PBR على FortiGate:**

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Policy Routes)**.
2.  انقر على **(Create New)**.
3.  حدد الـ **Incoming Interface**, **Source Address**, **Destination Address**, **Service** اللي عايز تطبق عليها الـ PBR.
4.  **Outgoing Interface:** اختار الواجهة اللي عايز الترافيك يطلع منها.
5.  **Gateway:** ممكن تحدد الـ Next-Hop IP.

**عبر CLI:**
```
config firewall policy-route
    edit 1
        set input-device "port1"
        set src "192.168.1.10"
        set dst "0.0.0.0"
        set protocol 6 # TCP
        set port 80 # HTTP
        set output-device "wan2"
        set gateway 10.0.0.1
    next
end
```

**مقارنة بـ Cisco PBR:**

Cisco بتدعم PBR بشكل كامل باستخدام الـ Route-Maps. المفهوم هو نفسه: بتحدد الـ Match Criteria (زي Source IP, Destination IP, Protocol) والـ Set Actions (زي Next-Hop IP, Output Interface). FortiGate بيقدم واجهة أبسط شوية، لكن الوظيفة هي هي.

## 8.2 الشبكات اللاسلكية (Wireless Networking)

### 8.2.1 FortiGate كـ Wireless Controller

FortiGate مش بس جدار حماية، ده كمان ممكن يشتغل كـ Wireless Controller عشان يدير نقاط الوصول اللاسلكية (FortiAPs). ده بيخليك تدير الشبكة السلكية واللاسلكية من مكان واحد، وبتطبق نفس السياسات الأمنية على الاتنين.

**ميزات FortiGate كـ Wireless Controller:**
-   **إدارة مركزية:** إدارة كل الـ FortiAPs من واجهة FortiGate واحدة.
-   **تكوين موحد:** تطبيق نفس إعدادات الـ Wi-Fi والـ Security Profiles على كل الـ FortiAPs.
-   **أمان متكامل:** تطبيق Firewall Policies و Security Profiles على الترافيك اللاسلكي.
-   **رؤية شاملة:** مراقبة أداء الشبكة اللاسلكية والمستخدمين المتصلين.

### 8.2.2 تكوين شبكة Wi-Fi (SSID)

**الخطوة 1: توصيل FortiAP بـ FortiGate:**
-   وصل الـ FortiAP بأي بورت على FortiGate (يفضل بورت مخصص للـ APs).
-   الـ FortiAP هيعمل Discover للـ FortiGate تلقائياً وهيسجل نفسه.

**الخطوة 2: تكوين SSID (Service Set Identifier) (GUI):**
1.  انتقل إلى **(WiFi & Switch Controller) -> (SSID)**.
2.  انقر على **(Create New)**.
3.  **Name:** اسم الشبكة اللاسلكية (مثلاً: `My_Secure_WiFi`).
4.  **Traffic Mode:**
    -   **Tunnel:** كل الترافيك من الـ AP بيروح للـ FortiGate عشان يتم فحصه وتطبيق السياسات عليه (الأكثر أماناً).
    -   **Bridge:** الـ AP بيعمل Bridge للترافيك مباشرة على الشبكة المحلية (أقل أماناً، لكن ممكن يكون أسرع).
5.  **Security Mode:**
    -   **Open:** بدون كلمة سر (غير آمن).
    -   **WPA2-Personal:** كلمة سر مشتركة (مناسب للشبكات الصغيرة).
    -   **WPA2-Enterprise:** بيستخدم خادم RADIUS للمصادقة (الأكثر أماناً للشركات).
6.  **VLAN ID:** ممكن تحدد VLAN للشبكة اللاسلكية دي عشان تعزلها عن الشبكات التانية.

**عبر CLI:**
```
config wireless-controller vap
    edit "My_Secure_WiFi"
        set ssid "My_Secure_WiFi"
        set security wpa2-personal
        set wpa-key "WiFiPassword123!"
        set vlanid 10
        set traffic-mode tunnel
    next
end
```

**الخطوة 3: ربط SSID بواجهة (GUI):**
1.  انتقل إلى **(WiFi & Switch Controller) -> (Managed FortiAPs)**.
2.  اختار الـ FortiAP اللي عايز تطبق عليه الـ SSID ده.
3.  في قسم **(Radio)**، اختار الـ SSID اللي عملته.

**الخطوة 4: إنشاء Firewall Policy للشبكة اللاسلكية:**

هتعمل سياسة تسمح للمستخدمين اللاسلكيين بالوصول للإنترنت، وتطبق عليها الـ Security Profiles المناسبة.

**مقارنة بـ Cisco Wireless LAN Controllers (WLC):**

Cisco WLCs بتوفر نفس الوظائف لإدارة نقاط الوصول اللاسلكية (Cisco Aps). بتسمح بتكوين SSIDs، وتطبيق سياسات أمنية، وإدارة المستخدمين. المفهوم هو نفسه: إدارة مركزية للشبكة اللاسلكية وتطبيق سياسات أمنية عليها.

## الخلاصة

في الفصل ده، اتعمقنا في مواضيع متقدمة زي التوجيه الديناميكي (OSPF, BGP) والـ Policy-Based Routing، اللي بتخليك تتحكم في حركة المرور بشكل دقيق جداً في الشبكات المعقدة. كمان، عرفنا إزاي FortiGate بيشتغل كـ Wireless Controller عشان يدير الشبكات اللاسلكية ويوفر حماية متكاملة.

دلوقتي أنت بقيت قادر على تصميم وإدارة شبكات أكبر وأكثر تعقيداً باستخدام FortiGate، وتوفر حلول توجيه متقدمة وشبكات لاسلكية آمنة. الفصل ده بيفتحلك أبواب كتير في عالم الشبكات.

يلا بينا على الفصل اللي جاي عشان نتكلم عن ميزات أمنية متقدمة أكتر، زي الـ SSL Inspection والـ Advanced Threat Protection، اللي بتخلي FortiGate خط الدفاع الأول ضد أحدث التهديدات.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل التاسع: ميزات الأمان المتقدمة (Advanced Security Features)

## نظرة عامة على الفصل

يا جماعة، بعد ما اتكلمنا عن التوجيه المتقدم والشبكات اللاسلكية، دلوقتي هنخش في قلب المعركة ضد التهديدات الحديثة: ميزات الأمان المتقدمة في FortiGate. الفصل ده هيوريك إزاي FortiGate بيقدر يحميك من الهجمات المعقدة اللي بتعدي من جدران الحماية التقليدية.

هنتكلم عن الـ SSL Inspection، ودي ميزة مهمة جداً عشان FortiGate يقدر يفحص الترافيك المشفر (زي HTTPS) ويكتشف التهديدات اللي ممكن تكون مستخبية جواه. كمان، هنتعمق في الـ Advanced Threat Protection (ATP) اللي بتشمل تقنيات زي الـ Sandbox عشان تكتشف البرامج الضارة الجديدة (Zero-day attacks) اللي محدش يعرفها. وهنشوف إزاي FortiGate بيقدر يتحكم في الوصول للشبكة بناءً على حالة الجهاز (Network Access Control - NAC) وإزاي بيقدر يعمل Bandwidth Control عشان يضمن إن التطبيقات المهمة ليها الأولوية.

الفصل ده هيخليك سابق بخطوة في عالم الأمن السيبراني، وهيوريك إزاي FortiGate بيوفر حماية شاملة ضد أحدث التهديدات. يلا بينا نخش في التفاصيل!

## 9.1 فحص SSL (SSL Inspection)

### 9.1.1 مفهوم SSL Inspection

معظم الترافيك على الإنترنت دلوقتي بقى مشفر باستخدام SSL/TLS (HTTPS). ده كويس للخصوصية، لكنه بيخلي اكتشاف التهديدات صعب على جدران الحماية التقليدية. الـ SSL Inspection (أو SSL Decryption) بتسمح للـ FortiGate إنه يفك تشفير الترافيك ده، يفحصه بحثاً عن تهديدات، وبعدين يشفره تاني ويبعته للوجهة.

**ليه بنحتاج SSL Inspection؟**
-   **اكتشاف التهديدات المخفية:** الفيروسات والبرامج الضارة ممكن تيجي جوه الترافيك المشفر.
-   **تطبيق السياسات:** الـ Web Filtering والـ Application Control والـ DLP مش هتشتغل صح على الترافيك المشفر من غير SSL Inspection.

**كيف يعمل SSL Inspection؟**

FortiGate بيشتغل كـ `Man-in-the-Middle` (بشكل شرعي). لما جهازك بيحاول يتصل بموقع HTTPS، FortiGate بيعترض الاتصال، وبيولد شهادة SSL خاصة بيه للموقع ده، وبيبعتها لجهازك. جهازك بيثق في شهادة FortiGate (بعد ما تثبت الـ Certificate Authority بتاع FortiGate على أجهزتك)، وبعدين FortiGate بيعمل اتصال حقيقي بالموقع الأصلي. كده FortiGate بيقدر يشوف الترافيك المشفر ويفحصه.

### 9.1.2 أنواع SSL Inspection

-   **Certificate Inspection (Flow-based):**
    -   بيفحص الشهادات بس، مش بيفك تشفير الترافيك كله.
    -   أسرع، لكنه أقل أماناً.
    -   مناسب للبيئات اللي فيها مشاكل في تثبيت الشهادات على الأجهزة.

-   **Deep Inspection (Proxy-based):**
    -   بيفك تشفير الترافيك كله ويفحصه بعمق.
    -   أكثر أماناً، لكنه بيحتاج تثبيت شهادة الـ FortiGate CA على كل الأجهزة في الشبكة.
    -   بيستهلك موارد أكتر من FortiGate.

### 9.1.3 تكوين SSL Inspection Profile

**عبر GUI:**
1.  انتقل إلى **(Security Profiles) -> (SSL/SSH Inspection)**.
2.  انقر على **(Create New)** أو عدّل الـ `deep-inspection` Profile.
3.  **Inspection Method:** اختار `Deep Inspection`.
4.  **Certificate Inspection Options:** ممكن تستثني بعض المواقع من الـ Inspection (زي المواقع البنكية).

**عبر CLI:**
```
config firewall ssl-ssh-profile
    edit "deep-inspection-profile"
        set inspect-all enable
        set ssl-flow-override disable
        set use-ssl-server-cert disable
        set untrusted-can-block enable
        set expired-can-block enable
        set revoked-can-block enable
        set unknown-can-block enable
        set ports 443
    next
end
```

### 9.1.4 ربط SSL Inspection Profile بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `SSL/SSH Inspection` واختر الـ Profile اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set ssl-ssh-profile "deep-inspection-profile"
    next
end
```

**مقارنة بـ Cisco Firepower SSL Decryption:**

Cisco Firepower NGFW بيوفر نفس إمكانيات فك تشفير SSL، وبيستخدم نفس المفهوم بتاع الـ Man-in-the-Middle. بيحتاج تثبيت شهادة الـ Firepower CA على الأجهزة عشان يشتغل صح. المفهوم هو نفسه: فحص الترافيك المشفر لزيادة الأمان.

## 9.2 الحماية المتقدمة من التهديدات (Advanced Threat Protection - ATP)

### 9.2.1 مفهوم ATP

ATP هي مجموعة من التقنيات اللي بتشتغل مع بعض عشان تحمي من التهديدات المتقدمة والمعقدة، خصوصاً هجمات الـ Zero-day (الهجمات اللي محدش يعرفها لسه). FortiGate بيحقق ده من خلال التكامل مع FortiSandbox.

**مكونات ATP:**
-   **Sandbox:** بيئة معزولة بيتم فيها تشغيل الملفات المشبوهة عشان نشوف سلوكها. لو الملف حاول يعمل حاجة غريبة (زي إنه يحاول يغير في ملفات النظام أو يتصل بسيرفرات مشبوهة)، الـ Sandbox بيكتشفه كبرنامج ضار.
-   **Anti-Malware:** بيستخدم توقيعات الفيروسات المعروفة.
-   **Threat Intelligence:** بيستخدم معلومات عن التهديدات الجديدة من FortiGuard Labs.

### 9.2.2 تكوين FortiSandbox Integration

**عبر GUI:**
1.  انتقل إلى **(Security Fabric) -> (Fabric Connectors)**.
2.  انقر على **(Create New)** واختار `FortiSandbox`.
3.  أدخل عنوان IP الـ FortiSandbox وكلمة السر.
4.  فعل الـ `File Filter` عشان FortiGate يبعت الملفات المشبوهة لـ FortiSandbox.

**عبر CLI:**
```
config system fortisandbox
    set status enable
    set server "10.0.0.250" # IP FortiSandbox
    set enc-algorithm high
    set sandbox-type fortisandbox
    set upload-option all
end
```

### 9.2.3 ربط Sandbox Profile بسياسة جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Security Profiles)**، فعل `Sandbox Inspection` واختر الـ Profile اللي عملته.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set av-profile "my_av_profile"
        set sandbox-profile "default"
    next
end
```

**مقارنة بـ Cisco Threat Defense (Firepower + AMP + Threat Grid):**

Cisco بتوفر حل ATP متكامل من خلال Firepower NGFW مع AMP (Advanced Malware Protection) و Threat Grid (حل الـ Sandbox بتاع Cisco). المفهوم هو نفسه: اكتشاف التهديدات المعروفة وغير المعروفة من خلال تحليل السلوك في بيئة معزولة.

## 9.3 التحكم في الوصول للشبكة (Network Access Control - NAC)

### 9.3.1 مفهوم NAC

NAC بيسمحلك تتحكم في الأجهزة اللي بتوصل لشبكتك بناءً على حالتها الأمنية. يعني ممكن تقول: "لو الجهاز ده عليه Antivirus شغال ومتحدث، اسمحله بالوصول الكامل. لو مش عليه، خليه يوصل للإنترنت بس، أو امنعه خالص". FortiGate بيحقق ده من خلال التكامل مع FortiNAC.

**فوائد NAC:**
-   **تحسين الأمان:** منع الأجهزة غير المتوافقة أو المصابة من الوصول للشبكة.
-   **الامتثال (Compliance):** ضمان أن الأجهزة تلتزم بالسياسات الأمنية للشركة.
-   **رؤية شاملة:** معرفة كل الأجهزة المتصلة بالشبكة وحالتها.

### 9.3.2 تكوين FortiNAC Integration

**عبر GUI:**
1.  انتقل إلى **(Security Fabric) -> (Fabric Connectors)**.
2.  انقر على **(Create New)** واختار `FortiNAC`.
3.  أدخل عنوان IP الـ FortiNAC وكلمة السر.

**عبر CLI:**
```
config system fortinac
    edit "FortiNAC_Server"
        set server "10.0.0.260"
        set username "fortinac_user"
        set password "FortiNACPass!"
    next
end
```

### 9.3.3 ربط NAC بسياسات جدار الحماية

بعد التكامل، FortiGate بيقدر يستخدم معلومات الـ NAC عشان يطبق سياسات جدار الحماية بناءً على حالة الجهاز. يعني ممكن تعمل سياسة تسمح لأجهزة معينة بالوصول بناءً على الـ Health Status بتاعها من FortiNAC.

**مقارنة بـ Cisco ISE:**

Cisco Identity Services Engine (ISE) هو حل Cisco للـ NAC. بيوفر نفس الوظائف: المصادقة، الترخيص، وتقييم حالة الجهاز. بيقدر يدمج مع أجهزة Cisco المختلفة (Switches, Routers, Wireless APs) عشان يفرض سياسات الوصول بناءً على هوية المستخدم وحالة الجهاز.

## 9.4 التحكم في عرض النطاق الترددي (Bandwidth Control)

### 9.4.1 مفهوم Bandwidth Control

Bandwidth Control (أو Quality of Service - QoS) بيسمحلك تتحكم في كمية عرض النطاق الترددي (Bandwidth) اللي التطبيقات أو المستخدمين بيستخدموها. ده بيضمن إن التطبيقات الحيوية (زي الـ VoIP أو الفيديو كونفرنس) ليها الأولوية، وإن التطبيقات اللي مش مهمة (زي تحميل الملفات الكبيرة) متستهلكش كل الـ Bandwidth.

### 9.4.2 تكوين Traffic Shapers

**عبر GUI:**
1.  انتقل إلى **(Policy & Objects) -> (Traffic Shapers)**.
2.  انقر على **(Create New)**.
3.  **Type:** `Shared` أو `Per-IP`.
4.  **Guaranteed Bandwidth:** أقل Bandwidth مضمون للترافيك ده.
5.  **Maximum Bandwidth:** أقصى Bandwidth ممكن الترافيك ده يستخدمه.

**عبر CLI:**
```
config firewall shaper traffic-shaper
    edit "High_Priority_Traffic"
        set per-ip-shaper disable
        set guaranteed-bandwidth 10000 # 10 Mbps
        set maximum-bandwidth 50000 # 50 Mbps
    next
end
```

### 9.4.3 ربط Traffic Shapers بسياسات جدار الحماية

**عبر GUI:**
1.  في سياسة جدار الحماية، في قسم **(Traffic Shaping)**، فعل `Traffic Shapers` واختر الـ Shaper اللي عملته للـ `Source` و `Destination`.

**عبر CLI:**
```
config firewall policy
    edit <policy_id>
        set traffic-shaper "High_Priority_Traffic"
        set traffic-shaper-reverse "High_Priority_Traffic"
    next
end
```

**مقارنة بـ Cisco QoS:**

Cisco عندها مجموعة واسعة من أدوات الـ QoS (Quality of Service) على Routers و Switches. بتستخدم مفاهيم زي Classification, Marking, Policing, Shaping, Queuing. المفهوم هو نفسه: التحكم في الترافيك عشان تضمن جودة الخدمة للتطبيقات الحيوية.

## الخلاصة

في الفصل ده، اتعمقنا في ميزات الأمان المتقدمة اللي بتخلي FortiGate في مصاف جدران الحماية من الجيل التالي. عرفنا إزاي الـ SSL Inspection بتكشف التهديدات المخفية في الترافيك المشفر، وإزاي الـ ATP بتحمي من هجمات الـ Zero-day من خلال الـ Sandbox.

كمان، فهمنا أهمية الـ NAC في التحكم في وصول الأجهزة للشبكة بناءً على حالتها الأمنية، وإزاي الـ Bandwidth Control بيضمن جودة الخدمة للتطبيقات الحيوية. كل دي ميزات بتخلي FortiGate حل أمني متكامل وقوي جداً.

دلوقتي أنت بقيت مسلح بالمعرفة اللازمة عشان تحمي شبكتك من أحدث وأعقد التهديدات. يلا بينا على الفصل اللي جاي عشان نتكلم عن استكشاف الأخطاء وإصلاحها (Troubleshooting) وأدوات التشخيص في FortiGate، عشان لو حصل أي مشكلة، تعرف تحلها بنفسك!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل العاشر: استكشاف الأخطاء وإصلاحها وأدوات التشخيص (Troubleshooting and Diagnostic Tools)

## نظرة عامة على الفصل

يا جماعة، بعد ما اتعلمنا كل حاجة عن FortiGate وإزاي نكونه ونأمن بيه الشبكة، دلوقتي جه وقت نتكلم عن أهم جزء لأي مهندس شبكات: استكشاف الأخطاء وإصلاحها (Troubleshooting). مهما كنت خبير، المشاكل بتحصل، والمهم إنك تعرف إزاي تلاقي المشكلة وتحلها بسرعة.

في الفصل ده، هنتعلم إزاي نستخدم أدوات التشخيص القوية اللي FortiGate بيوفرها في سطر الأوامر (CLI) عشان نكتشف المشاكل ونحلها. هنتكلم عن أوامر زي `diagnose debug flow` اللي بتوريك مسار الحزم جوه الجهاز، و `diagnose sniffer packet` اللي بتخليك تشوف الحزم وهي بتعدي على الواجهات. كمان، هنعرف إزاي نستخدم الـ Packet Capture عشان نحلل الترافيك بشكل أعمق.

الفصل ده هيخليك محترف في التعامل مع مشاكل FortiGate، وهيديك الثقة إنك تقدر تحل أي مشكلة تقابلك. يلا بينا نخش في التفاصيل!

## 10.1 مقدمة إلى استكشاف الأخطاء وإصلاحها (Introduction to Troubleshooting)

### 10.1.1 منهجية استكشاف الأخطاء وإصلاحها

عشان تحل أي مشكلة بشكل فعال، لازم تمشي على منهجية منظمة. متشتغلش عشوائي. دي منهجية بسيطة ممكن تمشي عليها:

1.  **تحديد المشكلة (Identify the Problem):**
    -   إيه اللي مش شغال؟ مين المتأثر؟ إمتى بدأت المشكلة؟ هل حصل أي تغييرات مؤخراً؟
    -   اجمع أكبر قدر ممكن من المعلومات من المستخدمين أو من أنظمة المراقبة.

2.  **تحديد النطاق (Establish a Theory of Probable Cause):**
    -   بناءً على المعلومات اللي جمعتها، حط فرضيات محتملة لسبب المشكلة.
    -   هل المشكلة في الشبكة؟ في الـ FortiGate؟ في السيرفر؟ في المستخدم؟

3.  **اختبار الفرضية (Test the Theory):**
    -   اختبر الفرضيات بتاعتك واحدة واحدة. ابدأ بالأسهل والأكثر احتمالاً.
    -   مثلاً: لو المشكلة في الوصول لموقع، جرب تعمل Ping، بعدين Traceroute، بعدين شوف الـ Firewall Policy.

4.  **وضع خطة عمل (Establish a Plan of Action):**
    -   بعد ما تحدد السبب المحتمل، حط خطة عشان تحل المشكلة. فكر في الخطوات اللي هتاخدها، وإيه اللي ممكن يحصل لو الخطة فشلت.

5.  **تنفيذ الخطة (Implement the Solution):**
    -   نفذ الخطة بتاعتك. سجل كل خطوة بتعملها عشان لو احتجت ترجع فيها.

6.  **التحقق من الحل (Verify Full System Functionality):**
    -   تأكد إن المشكلة اتحلت تماماً، وإن مفيش أي آثار جانبية للحل بتاعك.
    -   اسأل المستخدمين المتأثرين، وجرب بنفسك.

7.  **توثيق الحل (Document the Solution):**
    -   سجل المشكلة، سببها، والحل اللي عملته. ده هيساعدك لو المشكلة دي حصلت تاني، وهيساعد زمايلك.

### 10.1.2 أدوات التشخيص في FortiGate (CLI)

FortiGate بيوفر مجموعة كبيرة من أوامر الـ `diagnose` اللي بتخليك تشوف اللي بيحصل جوه الجهاز بشكل مفصل جداً. دي أهم الأوامر اللي هنستخدمها:

-   `diagnose debug flow`
-   `diagnose sniffer packet`
-   `get system status`
-   `get router info routing-table all`
-   `diagnose sys top`

**مقارنة بـ Cisco Troubleshooting:**

Cisco عندها نفس المنهجية، وبتوفر أوامر `show` و `debug` قوية جداً. مثلاً، `show ip route` زي `get router info routing-table all`، و `debug ip packet` زي `diagnose debug flow`. المفهوم واحد: استخدم الأدوات المتاحة عشان تشوف إيه اللي بيحصل في الشبكة والجهاز.

## 10.2 تتبع مسار الحزم (diagnose debug flow)

### 10.2.1 مفهوم `diagnose debug flow`

الأمر ده هو أهم أمر في الـ Troubleshooting على FortiGate. بيوريك بالظبط إزاي FortiGate بيتعامل مع كل حزمة (Packet) بتعدي من خلاله. بيوريك مسار الحزمة من أول ما تدخل FortiGate لحد ما تخرج منه، وإيه السياسات اللي طبقت عليها، وإيه المشاكل اللي حصلت.

### 10.2.2 استخدام `diagnose debug flow`

**الخطوة 1: تفعيل الـ Debug:**

قبل ما تبدأ، لازم تفعل الـ Debug وتحدد الفلاتر اللي عايزها عشان متطلعش معلومات كتير ملهاش لازمة.

```
# عشان تشوف كل الأوامر المتاحة
diagnose debug flow ?

# عشان تفعل الـ Debug وتحدد الفلاتر
diagnose debug flow filter clear
diagnose debug flow filter addr <Source_IP_Address> # أو Destination_IP_Address
diagnose debug flow filter port <Port_Number>
diagnose debug flow filter proto <Protocol_Number> # 6 for TCP, 17 for UDP
diagnose debug flow show console enable
diagnose debug flow show function enable
diagnose debug flow show iprope enable
diagnose debug flow trace start <Number_of_Packets> # عدد الحزم اللي عايز تشوفها

# مثال: تتبع ترافيك HTTP من IP معين
diagnose debug flow filter clear
diagnose debug flow filter addr 192.168.1.100
diagnose debug flow filter port 80
diagnose debug flow filter proto 6
diagnose debug flow show console enable
diagnose debug flow show function enable
diagnose debug flow show iprope enable
diagnose debug flow trace start 100
```

**الخطوة 2: عمل الترافيك اللي عايز تتبعه:**

بعد ما تفعل الـ Debug، اعمل الترافيك اللي عايز تتبعه (مثلاً: حاول تفتح الموقع اللي فيه مشكلة، أو اعمل Ping).

**الخطوة 3: إيقاف الـ Debug:**

بعد ما تخلص، لازم توقف الـ Debug عشان متستهلكش موارد الجهاز.

```
diagnose debug flow trace stop
diagnose debug flow show console disable
diagnose debug flow show function disable
diagnose debug flow show iprope disable
```

### 10.2.3 تحليل مخرجات `diagnose debug flow`

المخرجات بتكون مفصلة جداً، لكن ركز على الأجزاء دي:

-   **`id=`:** رقم تعريف الحزمة.
-   **`dir=`:** اتجاه الحزمة (inbound/outbound).
-   **`src=` و `dst=`:** عنوان الـ Source والـ Destination.
-   **`proto=` و `sport=` و `dport=`:** البروتوكول والـ Source Port والـ Destination Port.
-   **`policy_id=`:** رقم الـ Firewall Policy اللي الحزمة طابقتها.
-   **`drop` أو `deny`:** لو الحزمة تم إسقاطها أو رفضها، هيقولك السبب.

**مثال لمخرجات `diagnose debug flow`:**
```
id=20085 trace_id=1 func=print_pkt_info line=1840 msg="npu_handle_cap_off: packet is offloaded to npu"
id=20085 trace_id=1 func=__ip_session_run_main line=2574 msg="enter fast path"
id=20085 trace_id=1 func=ip_session_run_main line=2593 msg="ip_session_run_main: offloaded"
```

**مقارنة بـ Cisco:**

في Cisco، ممكن تستخدم `debug ip packet` أو `debug ip flow`، لكنها مش بنفس تفصيل `diagnose debug flow` في FortiGate. Cisco عندها `packet tracer` على الـ ASA اللي بيوفر وظيفة مشابهة لتتبع مسار الحزمة.

## 10.3 التقاط الحزم (Packet Capture)

### 10.3.1 مفهوم Packet Capture

الـ Packet Capture (أو Sniffer) بيسمحلك تلتقط الحزم اللي بتعدي على واجهة معينة في FortiGate، وتشوف محتواها. ده مفيد جداً لما تكون عايز تشوف إيه اللي بيحصل بالظبط على مستوى الشبكة، أو لما تكون عايز تحلل مشكلة معقدة.

### 10.3.2 استخدام `diagnose sniffer packet`

**الخطوة 1: تفعيل الـ Sniffer:**

```
# عشان تشوف كل الأوامر المتاحة
diagnose sniffer packet ?

# عشان تلتقط الحزم
diagnose sniffer packet <interface> <'filter'> <verbose> <count>

# interface: الواجهة اللي عايز تلتقط عليها (مثلاً: port1, wan1, any)
# filter: فلتر عشان تحدد نوع الترافيك اللي عايز تلتقطه (زي tcp port 80, host 192.168.1.1)
# verbose: مستوى التفاصيل (1: رؤوس الحزم، 2: رؤوس الحزم والـ IP، 3: رؤوس الحزم والـ IP والـ Ethernet، 4: كل حاجة)
# count: عدد الحزم اللي عايز تلتقطها

# مثال: التقاط 100 حزمة HTTP على واجهة port1
diagnose sniffer packet port1 'tcp port 80' 4 100

# مثال: التقاط ترافيك من IP معين على أي واجهة
diagnose sniffer packet any 'host 192.168.1.100' 4 0 # 0 يعني عدد لا نهائي
```

**الخطوة 2: عمل الترافيك اللي عايز تلتقطه:**

بعد ما تفعل الـ Sniffer، اعمل الترافيك اللي عايز تلتقطه.

**الخطوة 3: إيقاف الـ Sniffer:**

لو استخدمت `count`، الـ Sniffer هيقف لوحده. لو استخدمت `0`، لازم توقفه يدوياً بـ `Ctrl+C`.

### 10.3.3 تحليل مخرجات `diagnose sniffer packet`

المخرجات بتوريك كل حزمة، الـ Source IP والـ Destination IP، البورتات، والبروتوكولات. لو استخدمت `verbose 4`، هتشوف محتوى الحزمة كمان.

**مثال لمخرجات `diagnose sniffer packet`:**
```
interfaces=[port1] filters=[host 192.168.1.100] 
1.000000 192.168.1.100.1234 -> 8.8.8.8.53: udp 40
1.000100 8.8.8.8.53 -> 192.168.1.100.1234: udp 56
```

**مقارنة بـ Cisco:**

Cisco عندها أوامر `monitor capture` على الـ Routers والـ ASA اللي بتوفر وظيفة مشابهة لالتقاط الحزم. ممكن تحفظ الـ Capture في ملف وتفتحه ببرنامج زي Wireshark لتحليل أعمق. FortiGate أيضاً بيسمحلك تحفظ الـ Capture في ملف.

## الخلاصة

في الفصل ده، اتعلمنا إزاي نكون محترفين في استكشاف الأخطاء وإصلاحها على FortiGate. عرفنا منهجية منظمة لحل المشاكل، واتعمقنا في أهم أدوات التشخيص في الـ CLI زي `diagnose debug flow` و `diagnose sniffer packet`.

دلوقتي أنت بقيت قادر على تحديد المشاكل، تتبع مسار الحزم، وتحليل الترافيك عشان توصل لسبب المشكلة وتحلها بسرعة وكفاءة. الفصل ده هو مفتاحك عشان تبقى مهندس شبكات FortiGate متمكن.

يلا بينا على الفصل اللي جاي عشان نتكلم عن FortiManager و FortiAnalyzer، اللي بيساعدوك تدير وتراقب عدد كبير من أجهزة FortiGate بشكل مركزي.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الحادي عشر: FortiManager و FortiAnalyzer

## نظرة عامة على الفصل

يا جماعة، بعد ما اتعلمنا كل حاجة عن FortiGate كجهاز منفرد، دلوقتي جه وقت نتكلم عن إزاي Fortinet بتساعدك تدير وتراقب عدد كبير من أجهزة FortiGate في بيئة شبكة كبيرة ومعقدة. الفصل ده هيركز على FortiManager و FortiAnalyzer، وهما حلول مهمة جداً للإدارة المركزية والتحليل الأمني.

هنتكلم عن FortiManager، اللي بيسمحلك تدير كل أجهزة FortiGate بتاعتك من مكان واحد، وتطبق عليها سياسات موحدة، وتعمل تحديثات للـ Firmware بسهولة. ده بيوفر وقت ومجهود كبير في الشبكات اللي فيها أجهزة كتير. كمان، هنتعمق في FortiAnalyzer، اللي بيجمع كل السجلات (Logs) من أجهزة FortiGate، وبيحللها، وبيعمل تقارير مفصلة عشان يديك رؤية شاملة للوضع الأمني في شبكتك، ويكتشف التهديدات بشكل أسرع.

الفصل ده هيخليك تفهم إزاي Fortinet بتقدم حلول متكاملة لإدارة الأمن في الشركات الكبيرة، وإزاي تستفيد من الأدوات دي عشان تحسن كفاءة الإدارة والأمان. يلا بينا نخش في التفاصيل!

## 11.1 مقدمة إلى FortiManager

### 11.1.1 ما هو FortiManager؟

FortiManager هو منصة إدارة مركزية لأجهزة Fortinet الأمنية (FortiGate, FortiAP, FortiSwitch, FortiClient). تخيل إن عندك 50 جهاز FortiGate في فروع مختلفة، هل من المنطقي إنك تدخل على كل جهاز لوحده عشان تعمل تغيير بسيط في سياسة جدار الحماية؟ طبعاً لأ! FortiManager بيحل المشكلة دي.

**فوائد FortiManager:**
-   **إدارة مركزية (Centralized Management):** إدارة كل الأجهزة من واجهة واحدة.
-   **تطبيق السياسات (Policy Enforcement):** تطبيق سياسات أمنية موحدة على كل الأجهزة أو مجموعات منها.
-   **تحديثات الـ Firmware (Firmware Management):** تحديث الـ Firmware لكل الأجهزة بسهولة.
-   **مراجعة التكوين (Configuration Auditing):** مراجعة التكوين والتأكد من التزامها بالمعايير.
-   **نشر التكوين (Deployment):** نشر التكوين الجديد على أجهزة متعددة في نفس الوقت.

### 11.1.2 إضافة FortiGate إلى FortiManager

**الخطوة 1: تفعيل FortiManager على FortiGate (GUI):**
1.  انتقل إلى **(System) -> (Central Management)**.
2.  **FortiManager:** فعل `Enable`.
3.  **IP Address:** أدخل عنوان IP الـ FortiManager.
4.  **Registration Type:** `Local`.
5.  **Serial Number:** هيظهر الـ Serial Number بتاع FortiGate.

**عبر CLI:**
```
config system central-management
    set fmg "10.0.0.200" # IP FortiManager
    set fmg-source-ip 10.0.0.1 # IP الواجهة اللي FortiGate هيتصل منها بـ FMG
    set mode normal
    set type fortimanager
end
```

**الخطوة 2: قبول FortiGate على FortiManager (GUI):**
1.  على FortiManager، انتقل إلى **(Device Manager)**.
2.  هتلاقي الـ FortiGate اللي بيحاول يتصل. انقر عليه واعمل `Authorize`.
3.  بعد كده، ممكن تعمل `Import Policy & Objects` عشان تسحب التكوين الحالي من FortiGate للـ FortiManager.

**مقارنة بـ Cisco Prime Infrastructure:**

Cisco Prime Infrastructure بيوفر وظائف مشابهة لإدارة أجهزة Cisco (Routers, Switches, Wireless APs). بيسمح بالإدارة المركزية، وتطبيق القوالب (Templates)، ومراقبة الأداء. المفهوم هو نفسه: إدارة عدد كبير من الأجهزة من مكان واحد.

## 11.2 مقدمة إلى FortiAnalyzer

### 11.2.1 ما هو FortiAnalyzer؟

FortiAnalyzer هو منصة مركزية لتسجيل السجلات (Log Management)، والتحليل الأمني (Security Analysis)، والتقارير (Reporting) لأجهزة Fortinet. بيجمع كل السجلات من أجهزة FortiGate (وغيرها من أجهزة Fortinet)، وبيخزنها، وبيحللها عشان يديك رؤية شاملة للوضع الأمني في شبكتك.

**فوائد FortiAnalyzer:**
-   **تجميع السجلات (Log Aggregation):** جمع كل السجلات في مكان واحد.
-   **تحليل السجلات (Log Analysis):** تحليل السجلات واكتشاف الأنماط والتهديدات.
-   **التقارير (Reporting):** إنشاء تقارير مفصلة عن الوضع الأمني، والامتثال (Compliance).
-   **التحقيق في الحوادث (Incident Investigation):** تسهيل عملية التحقيق في الحوادث الأمنية.
-   **الامتثال (Compliance):** المساعدة في تلبية متطلبات الامتثال (زي PCI DSS, HIPAA).

### 11.2.2 ربط FortiGate بـ FortiAnalyzer

**الخطوة 1: تفعيل FortiAnalyzer على FortiGate (GUI):**
1.  انتقل إلى **(Log & Report) -> (Log Settings)**.
2.  في قسم **(FortiAnalyzer / FortiManager)**، فعل `Upload Logs to FortiAnalyzer / FortiManager`.
3.  **IP Address:** أدخل عنوان IP الـ FortiAnalyzer.
4.  **Upload Option:** `Realtime` (عشان السجلات تتبعت أول بأول).

**عبر CLI:**
```
config log fortianalyzer setting
    set status enable
    set server "10.0.0.250" # IP FortiAnalyzer
    set upload-option realtime
    set serial "FG1K5D3E4R5T6Y7U" # Serial Number بتاع FortiAnalyzer
end
```

**الخطوة 2: قبول FortiGate على FortiAnalyzer (GUI):**
1.  على FortiAnalyzer، انتقل إلى **(Device Manager)**.
2.  هتلاقي الـ FortiGate اللي بيحاول يبعت سجلات. انقر عليه واعمل `Authorize`.
3.  بعد كده، هتبدأ تشوف السجلات والتقارير من FortiGate ده على FortiAnalyzer.

**مقارنة بـ Cisco Stealthwatch (أو Splunk/ELK Stack):**

Cisco Stealthwatch (الآن جزء من Cisco Secure Network Analytics) بيوفر وظائف مشابهة لـ FortiAnalyzer في جمع وتحليل بيانات التدفق (Flow Data) والسجلات. في حلول عامة لجمع وتحليل السجلات زي Splunk أو ELK Stack (Elasticsearch, Logstash, Kibana) اللي ممكن تتكامل مع أجهزة Cisco وغيرها. المفهوم هو نفسه: جمع وتحليل السجلات لزيادة الرؤية الأمنية.

## 11.3 التكامل بين FortiManager و FortiAnalyzer

FortiManager و FortiAnalyzer ممكن يشتغلوا مع بعض بشكل متكامل عشان يوفروا حل أمني شامل:

-   **إدارة ونشر السياسات:** FortiManager بيستخدم لنشر السياسات على أجهزة FortiGate.
-   **جمع وتحليل السجلات:** FortiAnalyzer بيجمع السجلات من الأجهزة دي.
-   **التقارير والتحقيقات:** FortiAnalyzer بيستخدم لإنشاء التقارير والتحقيق في الحوادث.
-   **الرؤية الشاملة:** الاثنين مع بعض بيدوك رؤية كاملة للوضع الأمني في شبكتك، من الإدارة لحد التحليل.

## الخلاصة

في الفصل ده، اتعلمنا عن FortiManager و FortiAnalyzer، وهما أدوات قوية جداً لإدارة الأمن في الشبكات الكبيرة. عرفنا إزاي FortiManager بيسهل إدارة عدد كبير من أجهزة FortiGate، وإزاي FortiAnalyzer بيوفر رؤية شاملة للوضع الأمني من خلال جمع وتحليل السجلات.

دلوقتي أنت بقيت فاهم إزاي Fortinet بتقدم حلول متكاملة لإدارة الأمن، وإزاي تستفيد من الأدوات دي عشان تحسن كفاءة الإدارة والأمان في أي بيئة شبكة. الفصل ده بيفتحلك آفاق جديدة في عالم الـ Security Operations.

يلا بينا على الفصل اللي جاي عشان نتكلم عن أمثلة عملية وسيناريوهات تطبيقية، اللي هتوريك إزاي كل اللي اتعلمناه ده بيشتغل مع بعضه في سيناريوهات حقيقية.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الثاني عشر: أمثلة عملية وسيناريوهات تطبيقية (Practical Examples and Scenarios)

## نظرة عامة على الفصل

يا جماعة، بعد ما خلصنا كل المواضيع النظرية والتكوينات الفردية، دلوقتي جه وقت التطبيق العملي! الفصل ده هو اللي هيجمع كل اللي اتعلمناه في الفصول اللي فاتت، وهنوريك إزاي كل ده بيشتغل مع بعضه في سيناريوهات حقيقية ممكن تقابلك في الشغل.

هنتكلم عن سيناريوهات شائعة زي تأمين فرع شركة (Branch Office Deployment)، وتأمين الوصول عن بُعد (Securing Remote Access) للموظفين، وتأمين تطبيقات الويب (Web Application Security) من الهجمات. في كل سيناريو، هنراجع المكونات اللي هنستخدمها من FortiGate، وإزاي نربطها ببعض عشان نحقق الهدف الأمني المطلوب.

الفصل ده هيخليك تشوف الصورة الكبيرة، وإزاي FortiGate بيقدم حلول متكاملة لمشاكل أمنية حقيقية. يلا بينا نخش في التفاصيل!

## 12.1 تأمين فرع شركة (Branch Office Deployment)

### 12.1.1 السيناريو

عندك شركة ليها مقر رئيسي (Head Office) وفروع (Branch Offices) في أماكن مختلفة. عايز تربط الفروع بالمقر الرئيسي بشكل آمن، وتوفر للفرع وصول للإنترنت محمي، وتتحكم في الترافيك اللي رايح جاي بين الفرع والمقر الرئيسي، وبين الفرع والإنترنت.

**المتطلبات:**
-   اتصال آمن بين الفرع والمقر الرئيسي.
-   وصول آمن للإنترنت من الفرع.
-   تطبيق سياسات أمنية موحدة على ترافيك الفرع.

### 12.1.2 الحل باستخدام FortiGate

**المكونات الرئيسية:**
-   **FortiGate في المقر الرئيسي:** هيكون الـ Hub في الـ VPN.
-   **FortiGate في الفرع:** هيكون الـ Spoke في الـ VPN.
-   **IPsec VPN Site-to-Site:** لربط الفرع بالمقر الرئيسي بشكل آمن.
-   **Firewall Policies:** للتحكم في الترافيك بين الفرع والمقر الرئيسي، وبين الفرع والإنترنت.
-   **Security Profiles:** لتأمين ترافيك الإنترنت (Antivirus, IPS, Web Filter, Application Control).

**خطوات التكوين (ملخص):**

1.  **تكوين IPsec VPN Site-to-Site:**
    -   على FortiGate المقر الرئيسي والفرع، كون IPsec VPN Site-to-Site زي ما اتعلمنا في الفصل الخامس. تأكد من أن الـ Phase 1 والـ Phase 2 متطابقين، وأن الـ Local/Remote Subnets معرفة بشكل صحيح.

2.  **تكوين Static Routes:**
    -   على FortiGate المقر الرئيسي، اعمل Static Route للشبكة الداخلية للفرع عبر الـ IPsec Tunnel.
    -   على FortiGate الفرع، اعمل Static Route للشبكة الداخلية للمقر الرئيسي عبر الـ IPsec Tunnel.

3.  **تكوين Firewall Policies:**
    -   **ترافيك الفرع للمقر الرئيسي:**
        -   **Source Interface:** `lan` (في الفرع).
        -   **Destination Interface:** الـ IPsec Tunnel.
        -   **Source:** شبكة الفرع الداخلية.
        -   **Destination:** شبكة المقر الرئيسي الداخلية.
        -   **Action:** `ACCEPT`.
        -   **NAT:** `Disable`.
    -   **ترافيك المقر الرئيسي للفرع:** (نفس السياسة بس بالعكس).
    -   **ترافيك الفرع للإنترنت:**
        -   **Source Interface:** `lan` (في الفرع).
        -   **Destination Interface:** `wan1`.
        -   **Source:** شبكة الفرع الداخلية.
        -   **Destination:** `all`.
        -   **Action:** `ACCEPT`.
        -   **NAT:** `Enable`.
        -   **Security Profiles:** فعل الـ Antivirus, IPS, Web Filter, Application Control.

4.  **تكوين Security Profiles:**
    -   على FortiGate الفرع، كون الـ Security Profiles المناسبة (Antivirus, IPS, Web Filter, Application Control) وطبقها على سياسة الإنترنت.

**مقارنة بـ Cisco:**

نفس السيناريو ممكن يتم باستخدام Cisco Routers أو ASA. هتستخدم IPsec VPN Site-to-Site، وهتكون Static Routes، وهتطبق Access-lists أو Firepower Policies لتأمين الترافيك. المفهوم هو نفسه، لكن أوامر التكوين بتختلف.

## 12.2 تأمين الوصول عن بُعد (Securing Remote Access)

### 12.2.1 السيناريو

الموظفين بيشتغلوا من البيت أو من أي مكان بره الشركة، ومحتاجين يوصلوا لموارد الشركة الداخلية (ملفات، تطبيقات، سيرفرات) بشكل آمن.

**المتطلبات:**
-   وصول آمن للموظفين عن بُعد.
-   مصادقة قوية للمستخدمين.
-   تطبيق سياسات أمنية على ترافيك الـ VPN.

### 12.2.2 الحل باستخدام FortiGate

**المكونات الرئيسية:**
-   **FortiGate:** هيكون الـ VPN Server.
-   **SSL VPN:** لسهولة الوصول من أي مكان.
-   **FortiClient:** لإنشاء نفق VPN آمن.
-   **RADIUS/LDAP Authentication:** للمصادقة المركزية للمستخدمين.
-   **Two-Factor Authentication (2FA) with FortiToken:** لزيادة الأمان.
-   **Firewall Policies:** للتحكم في صلاحيات المستخدمين بعد الاتصال بالـ VPN.
-   **Security Profiles:** لتأمين ترافيك الـ VPN.

**خطوات التكوين (ملخص):**

1.  **تكوين SSL VPN:**
    -   فعل SSL VPN على واجهة FortiGate (غالباً `wan1`).
    -   حدد الـ IP Pool اللي هياخد منه مستخدمي الـ VPN IPs.
    -   كون SSL VPN Portal (Web Mode و Tunnel Mode).

2.  **تكوين المصادقة:**
    -   ربط FortiGate بخادم RADIUS أو LDAP (زي Active Directory) للمصادقة المركزية.
    -   فعل المصادقة الثنائية (2FA) باستخدام FortiToken للمستخدمين.
    -   كون User Group لمستخدمي الـ VPN.

3.  **تكوين Firewall Policies:**
    -   **Source Interface:** `ssl.root`.
    -   **Destination Interface:** `lan` (أو الواجهة اللي عليها الموارد الداخلية).
    -   **Source:** User Group لمستخدمي الـ VPN.
    -   **Destination:** الموارد الداخلية اللي عايز تسمح بالوصول ليها.
    -   **Action:** `ACCEPT`.
    -   **NAT:** `Enable`.
    -   **Security Profiles:** فعل الـ Antivirus, IPS, Web Filter, Application Control على ترافيك الـ VPN.

**مقارنة بـ Cisco:**

نفس السيناريو ممكن يتم باستخدام Cisco ASA مع AnyConnect VPN Client. هتستخدم RADIUS/LDAP للمصادقة، وممكن تدمجها مع Cisco Duo لـ 2FA. هتطبق Access-lists أو Firepower Policies للتحكم في الوصول. المفهوم هو نفسه، لكن الأدوات والتكوين بيختلف.

## 12.3 تأمين تطبيقات الويب (Web Application Security)

### 12.3.1 السيناريو

عندك تطبيقات ويب (Web Applications) مستضافة على سيرفرات داخلية، وعايز تحميها من الهجمات الشائعة على الويب (زي SQL Injection, Cross-Site Scripting - XSS) وتوفر وصول آمن للمستخدمين من الإنترنت.

**المتطلبات:**
-   حماية تطبيقات الويب من الهجمات.
-   نشر تطبيقات الويب بأمان على الإنترنت.
-   Load Balancing (اختياري) لو عندك أكتر من سيرفر.

### 12.3.2 الحل باستخدام FortiGate (مع FortiWeb)

FortiGate بيوفر حماية أساسية لتطبيقات الويب من خلال الـ Security Profiles، لكن للحماية المتقدمة، يفضل استخدام FortiWeb (Web Application Firewall - WAF).

**المكونات الرئيسية:**
-   **FortiGate:** هيكون الـ Edge Firewall.
-   **FortiWeb (WAF):** للحماية المتقدمة لتطبيقات الويب.
-   **Virtual IPs (VIPs):** لنشر تطبيقات الويب على الإنترنت.
-   **Firewall Policies:** للسماح بالترافيك لـ FortiWeb.
-   **Security Profiles:** (على FortiGate) للحماية الأساسية.

**خطوات التكوين (ملخص):**

1.  **تكوين Virtual IP (VIP) على FortiGate:**
    -   انتقل إلى **(Policy & Objects) -> (Virtual IPs)**.
    -   انقر على **(Create New)**.
    -   **External IP Address:** الـ Public IP اللي المستخدمين هيوصلوا بيه.
    -   **Mapped IP Address:** الـ IP بتاع سيرفر الويب الداخلي (أو FortiWeb لو هتستخدمه).
    -   **Port Forwarding:** فعلها لو عايز تعمل Port Forwarding لبورت معين (مثلاً: 80, 443).

2.  **تكوين Firewall Policy للسماح بالترافيك:**
    -   **Incoming Interface:** `wan1`.
    -   **Destination Interface:** `lan`.
    -   **Source:** `all`.
    -   **Destination:** الـ VIP اللي عملته.
    -   **Service:** `HTTP`, `HTTPS`.
    -   **Action:** `ACCEPT`.
    -   **Security Profiles:** فعل الـ Antivirus, IPS, Web Filter, Application Control.

3.  **تكوين FortiWeb (لو هتستخدمه):**
    -   هتوصل FortiWeb بين FortiGate وسيرفر الويب.
    -   هتكون الـ Policies على FortiWeb عشان تحمي من هجمات الـ OWASP Top 10 وغيرها.

**مقارنة بـ Cisco:**

Cisco عندها حلول WAF زي Cisco Secure Application (جزء من Firepower) أو عن طريق التكامل مع حلول WAF خارجية. المفهوم هو نفسه: حماية تطبيقات الويب من الهجمات المتخصصة.

## الخلاصة

في الفصل ده، شفنا إزاي كل اللي اتعلمناه في الفصول اللي فاتت بيشتغل مع بعضه في سيناريوهات حقيقية. اتعلمنا إزاي نأمن فروع الشركات، وإزاي نوفر وصول آمن للموظفين عن بُعد، وإزاي نحمي تطبيقات الويب.

الفصل ده بيوريك قوة FortiGate كحل أمني متكامل، وإزاي بيقدر يحل مشاكل أمنية معقدة في بيئات مختلفة. دلوقتي أنت بقيت جاهز إنك تصمم وتنفذ حلول أمنية باستخدام FortiGate في أي بيئة شبكة.

يلا بينا على الفصل الأخير، اللي هنتكلم فيه عن إزاي تستعد لامتحان شهادة FortiGate، وإيه هي أهم النصائح عشان تنجح فيه!

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

# الفصل الثالث عشر: التحضير للامتحان (Exam Preparation)

## نظرة عامة على الفصل

يا جماعة، وصلنا لأخر فصل في رحلتنا مع FortiGate! بعد ما غطينا كل حاجة من أول الأساسيات لحد الميزات المتقدمة، دلوقتي جه وقت نتكلم عن إزاي تحول كل المعرفة دي لشهادة معتمدة. الفصل ده هيركز على التحضير لامتحان FortiGate، وإيه هي أهم النصائح عشان تنجح فيه.

هنتكلم عن أهمية الشهادات في مجال الأمن السيبراني، وإيه هي شهادات Fortinet المتاحة. وهنديك شوية نصائح عملية عن إزاي تذاكر، وإيه هي المصادر اللي ممكن تعتمد عليها، وإزاي تدرب على الأسئلة. كمان، هنراجع أهم المواضيع اللي لازم تركز عليها في الامتحان، وإزاي تتجنب الأخطاء الشائعة.

الفصل ده هو خطوتك الأخيرة عشان تبقى خبير FortiGate معتمد. يلا بينا نخش في التفاصيل!

## 13.1 أهمية شهادات Fortinet

### 13.1.1 لماذا شهادات الأمن السيبراني؟

في سوق العمل التنافسي بتاع دلوقتي، الشهادات الاحترافية بقت ضرورة مش رفاهية. شهادات الأمن السيبراني بتثبت إن عندك المعرفة والمهارات اللازمة عشان تحمي الشبكات والأنظمة. بالنسبة لـ Fortinet، شهاداتهم بتثبت إنك خبير في منتجاتهم، ودي حاجة مطلوبة جداً في شركات كتير بتستخدم FortiGate.

**فوائد شهادات Fortinet:**
-   **إثبات المعرفة:** بتثبت إنك فاهم منتجات Fortinet كويس.
-   **فرص عمل أفضل:** بتفتحلك أبواب لفرص عمل أكتر في مجال الأمن السيبراني.
-   **زيادة الثقة:** بتديك ثقة في نفسك وفي قدراتك.
-   **الاعتراف الصناعي:** Fortinet شركة رائدة في مجال الأمن، وشهاداتها معترف بيها عالمياً.

### 13.1.2 مسار شهادات Fortinet (NSE)

Fortinet عندها برنامج شهادات اسمه NSE (Network Security Expert). البرنامج ده متقسم لمستويات، من NSE 1 لحد NSE 8:

-   **NSE 1-3:** مستويات أساسية للمبتدئين، بتركز على مفاهيم الأمن السيبراني العامة.
-   **NSE 4:** دي الشهادة اللي بتركز على FortiGate (Fortinet Certified Associate - FCSA). دي أهم شهادة لأي حد عايز يشتغل على FortiGate.
-   **NSE 5-6:** بتركز على منتجات Fortinet التانية (زي FortiManager, FortiAnalyzer, FortiClient).
-   **NSE 7:** بتركز على الحلول الأمنية المتقدمة (Advanced Threat Protection, Cloud Security).
-   **NSE 8:** دي أعلى شهادة، بتثبت إنك خبير أمني شامل في منتجات Fortinet.

**مقارنة بشهادات Cisco:**

Cisco عندها مسار شهادات مشابه (CCNA, CCNP, CCIE) بيركز على منتجات Cisco. المفهوم واحد: كل شركة بتوفر شهادات لمنتجاتها عشان تثبت كفاءة المهندسين في استخدامها.

## 13.2 نصائح للتحضير للامتحان

### 13.2.1 فهم المنهج (Understand the Exam Blueprint)

قبل ما تبدأ تذاكر، لازم تفهم كويس إيه المواضيع اللي الامتحان بيركز عليها. Fortinet بتوفر `Exam Blueprint` لكل شهادة، وده بيوريك بالظبط إيه هي الأقسام اللي الامتحان هيغطيها، وإيه هي نسبة كل قسم في الامتحان.

### 13.2.2 المصادر التعليمية (Study Resources)

-   **دليل الدراسة الرسمي (Official Study Guide):** زي الـ PDF اللي استخدمناه في الشرح ده. ده أهم مصدر للمذاكرة.
-   **دورات Fortinet التدريبية (Fortinet Training Courses):** Fortinet بتوفر دورات تدريبية رسمية (ممكن تكون أونلاين أو في مراكز تدريب معتمدة). الدورات دي بتغطي المنهج بشكل مفصل وبتوفر معامل عملية.
-   **معامل FortiGate الافتراضية (FortiGate Virtual Labs):** حاول تطبق كل اللي بتتعلمه عملياً. ممكن تستخدم FortiGate VM (Virtual Machine) على جهازك، أو تستخدم معامل Fortinet الرسمية.
-   **مراجعة الـ CLI:** لازم تكون متمكن من استخدام سطر الأوامر (CLI) على FortiGate، لأن فيه أسئلة كتير بتيجي عليه.

### 13.2.3 الممارسة وحل الأسئلة (Practice and Mock Exams)

-   **حل أسئلة المراجعة:** بعد كل فصل، حل أسئلة المراجعة عشان تتأكد إنك فهمت الموضوع كويس.
-   **امتحانات تجريبية (Mock Exams):** حاول تحل امتحانات تجريبية كتير عشان تتعود على شكل الأسئلة وتدير وقتك صح في الامتحان الحقيقي.
-   **مراجعة الأخطاء:** بعد كل امتحان تجريبي، راجع الأخطاء اللي عملتها وافهم ليه كانت غلط، عشان متكررهاش تاني.

### 13.2.4 نصائح إضافية

-   **التركيز على المفاهيم:** متحفظش بس، افهم ليه الحاجة دي بتتعمل كده.
-   **الربط بالواقع:** حاول تربط اللي بتذاكره بسيناريوهات حقيقية ممكن تقابلك في الشغل.
-   **إدارة الوقت:** خصص وقت كافي للمذاكرة، ومتزنقش نفسك قبل الامتحان.
-   **الراحة:** خد فترات راحة كافية، ومتضغطش على نفسك.

## 13.3 مراجعة سريعة لأهم المواضيع

-   **الأساسيات:** واجهة المستخدم، الأوضاع التشغيلية (NAT/Route, Transparent)، إدارة الجهاز (Firmware, Backup/Restore).
-   **الشبكات:** تكوين الواجهات (Interfaces)، الـ VLANs، الـ Link Aggregation.
-   **جدار الحماية (Firewall Policies):** كيفية عمل السياسات، الـ NAT، الـ Virtual IPs.
-   **المصادقة (Authentication):** المستخدمون المحليون، RADIUS, LDAP, 2FA, SAML SSO.
-   **الـ VPNs:** SSL VPN (Remote Access), IPsec VPN (Site-to-Site), Troubleshooting.
-   **ملفات تعريف الأمان (Security Profiles):** Antivirus, IPS, Web Filter, Application Control, DLP, SSL Inspection.
-   **إدارة النظام:** Logging, Monitoring, Reporting, Alerting.
-   **التوافرية العالية (HA):** Active-Passive, Failover.
-   **التوجيه المتقدم:** OSPF, BGP, PBR.
-   **الشبكات اللاسلكية:** FortiGate كـ Wireless Controller.
-   **أدوات التشخيص:** `diagnose debug flow`, `diagnose sniffer packet`.
-   **الإدارة المركزية:** FortiManager, FortiAnalyzer.

## الخلاصة

مبروك! أنت دلوقتي خلصت رحلتك في منهج FortiGate. الفصل ده كان بمثابة خريطة طريق عشان تستعد للامتحان وتنجح فيه. تذكر إن النجاح في الامتحان مش بس بيعتمد على المذاكرة، لكن كمان على الفهم العميق للمفاهيم والقدرة على تطبيقها عملياً.

أتمنى لك كل التوفيق في امتحاناتك وفي مسيرتك المهنية في مجال الأمن السيبراني. FortiGate أداة قوية جداً، وإتقانها هيفتحلك أبواب كتير. استمر في التعلم والممارسة، ومتبطلش تطور من نفسك.

---

*تأليف: Manus AI*
*تاريخ الإنشاء: ديسمبر 2024*

